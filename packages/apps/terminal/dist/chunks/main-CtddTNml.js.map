{"version":3,"file":"main-CtddTNml.js","sources":["../../../../../node_modules/anser/lib/index.js","../../../../../node_modules/escape-carriage/index.js","../../src/components/Ansi.tsx","../../src/components/OutputLine.tsx","../../src/components/InputLine.tsx","../../src/constants/terminal.const.ts","../../src/core/stream.ts","../../src/core/_utils/terminal.utils.ts","../../src/core/commands.ts","../../src/components/Terminal.tsx","../../src/main.ts"],"sourcesContent":["\"use strict\";\n\n// This file was originally written by @drudru (https://github.com/drudru/ansi_up), MIT, 2011\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ANSI_COLORS = [[{ color: \"0, 0, 0\", \"class\": \"ansi-black\" }, { color: \"187, 0, 0\", \"class\": \"ansi-red\" }, { color: \"0, 187, 0\", \"class\": \"ansi-green\" }, { color: \"187, 187, 0\", \"class\": \"ansi-yellow\" }, { color: \"0, 0, 187\", \"class\": \"ansi-blue\" }, { color: \"187, 0, 187\", \"class\": \"ansi-magenta\" }, { color: \"0, 187, 187\", \"class\": \"ansi-cyan\" }, { color: \"255,255,255\", \"class\": \"ansi-white\" }], [{ color: \"85, 85, 85\", \"class\": \"ansi-bright-black\" }, { color: \"255, 85, 85\", \"class\": \"ansi-bright-red\" }, { color: \"0, 255, 0\", \"class\": \"ansi-bright-green\" }, { color: \"255, 255, 85\", \"class\": \"ansi-bright-yellow\" }, { color: \"85, 85, 255\", \"class\": \"ansi-bright-blue\" }, { color: \"255, 85, 255\", \"class\": \"ansi-bright-magenta\" }, { color: \"85, 255, 255\", \"class\": \"ansi-bright-cyan\" }, { color: \"255, 255, 255\", \"class\": \"ansi-bright-white\" }]];\n// https://datatracker.ietf.org/doc/html/rfc3986#appendix-A\nvar linkRegex = /(https?:\\/\\/(?:[A-Za-z0-9#;/?:@=+$',_.!~*()[\\]-]|&amp;|%[A-Fa-f0-9]{2})+)/gm;\n\nvar Anser = function () {\n    _createClass(Anser, null, [{\n        key: \"escapeForHtml\",\n\n\n        /**\n         * Anser.escapeForHtml\n         * Escape the input HTML.\n         *\n         * This does the minimum escaping of text to make it compliant with HTML.\n         * In particular, the '&','<', and '>' characters are escaped. This should\n         * be run prior to `ansiToHtml`.\n         *\n         * @name Anser.escapeForHtml\n         * @function\n         * @param {String} txt The input text (containing the ANSI snippets).\n         * @returns {String} The escaped html.\n         */\n        value: function escapeForHtml(txt) {\n            return new Anser().escapeForHtml(txt);\n        }\n\n        /**\n         * Anser.linkify\n         * Adds the links in the HTML.\n         *\n         * This replaces any links in the text with anchor tags that display the\n         * link. You should apply this after you have run `ansiToHtml` on the text.\n         *\n         * @name Anser.linkify\n         * @function\n         * @param {String} txt The input text.\n         * @returns {String} The HTML containing the <a> tags (unescaped).\n         */\n\n    }, {\n        key: \"linkify\",\n        value: function linkify(txt) {\n            return new Anser().linkify(txt);\n        }\n\n        /**\n         * Anser.ansiToHtml\n         * This replaces ANSI terminal escape codes with SPAN tags that wrap the\n         * content.\n         *\n         * This function only interprets ANSI SGR (Select Graphic Rendition) codes\n         * that can be represented in HTML.\n         * For example, cursor movement codes are ignored and hidden from output.\n         * The default style uses colors that are very close to the prescribed\n         * standard. The standard assumes that the text will have a black\n         * background. These colors are set as inline styles on the SPAN tags.\n         *\n         * Another option is to set `use_classes: true` in the options argument.\n         * This will instead set classes on the spans so the colors can be set via\n         * CSS. The class names used are of the format `ansi-*-fg/bg` and\n         * `ansi-bright-*-fg/bg` where `*` is the color name,\n         * i.e black/red/green/yellow/blue/magenta/cyan/white.\n         *\n         * @name Anser.ansiToHtml\n         * @function\n         * @param {String} txt The input text.\n         * @param {Object} options The options passed to the ansiToHTML method.\n         * @returns {String} The HTML output.\n         */\n\n    }, {\n        key: \"ansiToHtml\",\n        value: function ansiToHtml(txt, options) {\n            return new Anser().ansiToHtml(txt, options);\n        }\n\n        /**\n         * Anser.ansiToJson\n         * Converts ANSI input into JSON output.\n         *\n         * @name Anser.ansiToJson\n         * @function\n         * @param {String} txt The input text.\n         * @param {Object} options The options passed to the ansiToHTML method.\n         * @returns {String} The HTML output.\n         */\n\n    }, {\n        key: \"ansiToJson\",\n        value: function ansiToJson(txt, options) {\n            return new Anser().ansiToJson(txt, options);\n        }\n\n        /**\n         * Anser.ansiToText\n         * Converts ANSI input into text output.\n         *\n         * @name Anser.ansiToText\n         * @function\n         * @param {String} txt The input text.\n         * @returns {String} The text output.\n         */\n\n    }, {\n        key: \"ansiToText\",\n        value: function ansiToText(txt) {\n            return new Anser().ansiToText(txt);\n        }\n\n        /**\n         * Anser\n         * The `Anser` class.\n         *\n         * @name Anser\n         * @function\n         * @returns {Anser}\n         */\n\n    }]);\n\n    function Anser() {\n        _classCallCheck(this, Anser);\n\n        this.fg = this.bg = this.fg_truecolor = this.bg_truecolor = null;\n        this.bright = 0;\n        this.decorations = [];\n    }\n\n    /**\n     * setupPalette\n     * Sets up the palette.\n     *\n     * @name setupPalette\n     * @function\n     */\n\n\n    _createClass(Anser, [{\n        key: \"setupPalette\",\n        value: function setupPalette() {\n            this.PALETTE_COLORS = [];\n\n            // Index 0..15 : System color\n            for (var i = 0; i < 2; ++i) {\n                for (var j = 0; j < 8; ++j) {\n                    this.PALETTE_COLORS.push(ANSI_COLORS[i][j].color);\n                }\n            }\n\n            // Index 16..231 : RGB 6x6x6\n            // https://gist.github.com/jasonm23/2868981#file-xterm-256color-yaml\n            var levels = [0, 95, 135, 175, 215, 255];\n            var format = function format(r, g, b) {\n                return levels[r] + \", \" + levels[g] + \", \" + levels[b];\n            };\n            var r = void 0,\n                g = void 0,\n                b = void 0;\n            for (var _r = 0; _r < 6; ++_r) {\n                for (var _g = 0; _g < 6; ++_g) {\n                    for (var _b = 0; _b < 6; ++_b) {\n                        this.PALETTE_COLORS.push(format(_r, _g, _b));\n                    }\n                }\n            }\n\n            // Index 232..255 : Grayscale\n            var level = 8;\n            for (var _i = 0; _i < 24; ++_i, level += 10) {\n                this.PALETTE_COLORS.push(format(level, level, level));\n            }\n        }\n\n        /**\n         * escapeForHtml\n         * Escapes the input text.\n         *\n         * @name escapeForHtml\n         * @function\n         * @param {String} txt The input text.\n         * @returns {String} The escpaed HTML output.\n         */\n\n    }, {\n        key: \"escapeForHtml\",\n        value: function escapeForHtml(txt) {\n            return txt.replace(/[&<>\\\"]/gm, function (str) {\n                return str == \"&\" ? \"&amp;\" : str == '\"' ? \"&quot;\" : str == \"<\" ? \"&lt;\" : str == \">\" ? \"&gt;\" : \"\";\n            });\n        }\n\n        /**\n         * linkify\n         * Adds HTML link elements.\n         *\n         * @name linkify\n         * @function\n         * @param {String} txt The input text.\n         * @returns {String} The HTML output containing link elements.\n         */\n\n    }, {\n        key: \"linkify\",\n        value: function linkify(txt) {\n            return txt.replace(linkRegex, function (str) {\n                return \"<a href=\\\"\" + str + \"\\\">\" + str + \"</a>\";\n            });\n        }\n\n        /**\n         * ansiToHtml\n         * Converts ANSI input into HTML output.\n         *\n         * @name ansiToHtml\n         * @function\n         * @param {String} txt The input text.\n         * @param {Object} options The options passed ot the `process` method.\n         * @returns {String} The HTML output.\n         */\n\n    }, {\n        key: \"ansiToHtml\",\n        value: function ansiToHtml(txt, options) {\n            return this.process(txt, options, true);\n        }\n\n        /**\n         * ansiToJson\n         * Converts ANSI input into HTML output.\n         *\n         * @name ansiToJson\n         * @function\n         * @param {String} txt The input text.\n         * @param {Object} options The options passed ot the `process` method.\n         * @returns {String} The JSON output.\n         */\n\n    }, {\n        key: \"ansiToJson\",\n        value: function ansiToJson(txt, options) {\n            options = options || {};\n            options.json = true;\n            options.clearLine = false;\n            return this.process(txt, options, true);\n        }\n\n        /**\n         * ansiToText\n         * Converts ANSI input into HTML output.\n         *\n         * @name ansiToText\n         * @function\n         * @param {String} txt The input text.\n         * @returns {String} The text output.\n         */\n\n    }, {\n        key: \"ansiToText\",\n        value: function ansiToText(txt) {\n            return this.process(txt, {}, false);\n        }\n\n        /**\n         * process\n         * Processes the input.\n         *\n         * @name process\n         * @function\n         * @param {String} txt The input text.\n         * @param {Object} options An object passed to `processChunk` method, extended with:\n         *\n         *  - `json` (Boolean): If `true`, the result will be an object.\n         *  - `use_classes` (Boolean): If `true`, HTML classes will be appended to the HTML output.\n         *\n         * @param {Boolean} markup\n         */\n\n    }, {\n        key: \"process\",\n        value: function process(txt, options, markup) {\n            var _this = this;\n\n            var self = this;\n            var raw_text_chunks = txt.split(/\\033\\[/);\n            var first_chunk = raw_text_chunks.shift(); // the first chunk is not the result of the split\n\n            if (options === undefined || options === null) {\n                options = {};\n            }\n            options.clearLine = /\\r/.test(txt); // check for Carriage Return\n            var color_chunks = raw_text_chunks.map(function (chunk) {\n                return _this.processChunk(chunk, options, markup);\n            });\n\n            if (options && options.json) {\n                var first = self.processChunkJson(\"\");\n                first.content = first_chunk;\n                first.clearLine = options.clearLine;\n                color_chunks.unshift(first);\n                if (options.remove_empty) {\n                    color_chunks = color_chunks.filter(function (c) {\n                        return !c.isEmpty();\n                    });\n                }\n                return color_chunks;\n            } else {\n                color_chunks.unshift(first_chunk);\n            }\n\n            return color_chunks.join(\"\");\n        }\n\n        /**\n         * processChunkJson\n         * Processes the current chunk into json output.\n         *\n         * @name processChunkJson\n         * @function\n         * @param {String} text The input text.\n         * @param {Object} options An object containing the following fields:\n         *\n         *  - `json` (Boolean): If `true`, the result will be an object.\n         *  - `use_classes` (Boolean): If `true`, HTML classes will be appended to the HTML output.\n         *\n         * @param {Boolean} markup If false, the colors will not be parsed.\n         * @return {Object} The result object:\n         *\n         *  - `content` (String): The text.\n         *  - `fg` (String|null): The foreground color.\n         *  - `bg` (String|null): The background color.\n         *  - `fg_truecolor` (String|null): The foreground true color (if 16m color is enabled).\n         *  - `bg_truecolor` (String|null): The background true color (if 16m color is enabled).\n         *  - `clearLine` (Boolean): `true` if a carriageReturn \\r was fount at end of line.\n         *  - `was_processed` (Bolean): `true` if the colors were processed, `false` otherwise.\n         *  - `isEmpty` (Function): A function returning `true` if the content is empty, or `false` otherwise.\n         *\n         */\n\n    }, {\n        key: \"processChunkJson\",\n        value: function processChunkJson(text, options, markup) {\n\n            // Are we using classes or styles?\n            options = typeof options == \"undefined\" ? {} : options;\n            var use_classes = options.use_classes = typeof options.use_classes != \"undefined\" && options.use_classes;\n            var key = options.key = use_classes ? \"class\" : \"color\";\n\n            var result = {\n                content: text,\n                fg: null,\n                bg: null,\n                fg_truecolor: null,\n                bg_truecolor: null,\n                isInverted: false,\n                clearLine: options.clearLine,\n                decoration: null,\n                decorations: [],\n                was_processed: false,\n                isEmpty: function isEmpty() {\n                    return !result.content;\n                }\n            };\n\n            // Each \"chunk\" is the text after the CSI (ESC + \"[\") and before the next CSI/EOF.\n            //\n            // This regex matches four groups within a chunk.\n            //\n            // The first and third groups match code type.\n            // We supported only SGR command. It has empty first group and \"m\" in third.\n            //\n            // The second group matches all of the number+semicolon command sequences\n            // before the \"m\" (or other trailing) character.\n            // These are the graphics or SGR commands.\n            //\n            // The last group is the text (including newlines) that is colored by\n            // the other group\"s commands.\n            var matches = text.match(/^([!\\x3c-\\x3f]*)([\\d;]*)([\\x20-\\x2c]*[\\x40-\\x7e])([\\s\\S]*)/m);\n\n            if (!matches) return result;\n\n            var orig_txt = result.content = matches[4];\n            var nums = matches[2].split(\";\");\n\n            // We currently support only \"SGR\" (Select Graphic Rendition)\n            // Simply ignore if not a SGR command.\n            if (matches[1] !== \"\" || matches[3] !== \"m\") {\n                return result;\n            }\n\n            if (!markup) {\n                return result;\n            }\n\n            var self = this;\n\n            while (nums.length > 0) {\n                var num_str = nums.shift();\n                var num = parseInt(num_str);\n\n                if (isNaN(num) || num === 0) {\n                    self.fg = self.bg = null;\n                    self.decorations = [];\n                } else if (num === 1) {\n                    self.decorations.push(\"bold\");\n                } else if (num === 2) {\n                    self.decorations.push(\"dim\");\n                    // Enable code 2 to get string\n                } else if (num === 3) {\n                    self.decorations.push(\"italic\");\n                } else if (num === 4) {\n                    self.decorations.push(\"underline\");\n                } else if (num === 5) {\n                    self.decorations.push(\"blink\");\n                } else if (num === 7) {\n                    self.decorations.push(\"reverse\");\n                } else if (num === 8) {\n                    self.decorations.push(\"hidden\");\n                    // Enable code 9 to get strikethrough\n                } else if (num === 9) {\n                    self.decorations.push(\"strikethrough\");\n                    /**\n                     * Add several widely used style codes\n                     * @see https://en.wikipedia.org/wiki/ANSI_escape_code#SGR_(Select_Graphic_Rendition)_parameters\n                     */\n                } else if (num === 21) {\n                    self.removeDecoration(\"bold\");\n                } else if (num === 22) {\n                    self.removeDecoration(\"bold\");\n                    self.removeDecoration(\"dim\");\n                } else if (num === 23) {\n                    self.removeDecoration(\"italic\");\n                } else if (num === 24) {\n                    self.removeDecoration(\"underline\");\n                } else if (num === 25) {\n                    self.removeDecoration(\"blink\");\n                } else if (num === 27) {\n                    self.removeDecoration(\"reverse\");\n                } else if (num === 28) {\n                    self.removeDecoration(\"hidden\");\n                } else if (num === 29) {\n                    self.removeDecoration(\"strikethrough\");\n                } else if (num === 39) {\n                    self.fg = null;\n                } else if (num === 49) {\n                    self.bg = null;\n                    // Foreground color\n                } else if (num >= 30 && num < 38) {\n                    self.fg = ANSI_COLORS[0][num % 10][key];\n                    // Foreground bright color\n                } else if (num >= 90 && num < 98) {\n                    self.fg = ANSI_COLORS[1][num % 10][key];\n                    // Background color\n                } else if (num >= 40 && num < 48) {\n                    self.bg = ANSI_COLORS[0][num % 10][key];\n                    // Background bright color\n                } else if (num >= 100 && num < 108) {\n                    self.bg = ANSI_COLORS[1][num % 10][key];\n                } else if (num === 38 || num === 48) {\n                    // extend color (38=fg, 48=bg)\n                    var is_foreground = num === 38;\n                    if (nums.length >= 1) {\n                        var mode = nums.shift();\n                        if (mode === \"5\" && nums.length >= 1) {\n                            // palette color\n                            var palette_index = parseInt(nums.shift());\n                            if (palette_index >= 0 && palette_index <= 255) {\n                                if (!use_classes) {\n                                    if (!this.PALETTE_COLORS) {\n                                        self.setupPalette();\n                                    }\n                                    if (is_foreground) {\n                                        self.fg = this.PALETTE_COLORS[palette_index];\n                                    } else {\n                                        self.bg = this.PALETTE_COLORS[palette_index];\n                                    }\n                                } else {\n                                    var klass = palette_index >= 16 ? \"ansi-palette-\" + palette_index : ANSI_COLORS[palette_index > 7 ? 1 : 0][palette_index % 8][\"class\"];\n                                    if (is_foreground) {\n                                        self.fg = klass;\n                                    } else {\n                                        self.bg = klass;\n                                    }\n                                }\n                            }\n                        } else if (mode === \"2\" && nums.length >= 3) {\n                            // true color\n                            var r = parseInt(nums.shift());\n                            var g = parseInt(nums.shift());\n                            var b = parseInt(nums.shift());\n                            if (r >= 0 && r <= 255 && g >= 0 && g <= 255 && b >= 0 && b <= 255) {\n                                var color = r + \", \" + g + \", \" + b;\n                                if (!use_classes) {\n                                    if (is_foreground) {\n                                        self.fg = color;\n                                    } else {\n                                        self.bg = color;\n                                    }\n                                } else {\n                                    if (is_foreground) {\n                                        self.fg = \"ansi-truecolor\";\n                                        self.fg_truecolor = color;\n                                    } else {\n                                        self.bg = \"ansi-truecolor\";\n                                        self.bg_truecolor = color;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n\n            if (self.fg === null && self.bg === null && self.decorations.length === 0) {\n                return result;\n            } else {\n                var styles = [];\n                var classes = [];\n                var data = {};\n\n                result.fg = self.fg;\n                result.bg = self.bg;\n                result.fg_truecolor = self.fg_truecolor;\n                result.bg_truecolor = self.bg_truecolor;\n                result.decorations = self.decorations;\n                result.decoration = self.decorations.slice(-1).pop() || null;\n                result.was_processed = true;\n\n                return result;\n            }\n        }\n\n        /**\n         * processChunk\n         * Processes the current chunk of text.\n         *\n         * @name processChunk\n         * @function\n         * @param {String} text The input text.\n         * @param {Object} options An object containing the following fields:\n         *\n         *  - `json` (Boolean): If `true`, the result will be an object.\n         *  - `use_classes` (Boolean): If `true`, HTML classes will be appended to the HTML output.\n         *\n         * @param {Boolean} markup If false, the colors will not be parsed.\n         * @return {Object|String} The result (object if `json` is wanted back or string otherwise).\n         */\n\n    }, {\n        key: \"processChunk\",\n        value: function processChunk(text, options, markup) {\n            var _this2 = this;\n\n            options = options || {};\n            var jsonChunk = this.processChunkJson(text, options, markup);\n            var use_classes = options.use_classes;\n\n            // \"reverse\" decoration reverses foreground and background colors\n            jsonChunk.decorations = jsonChunk.decorations.filter(function (decoration) {\n                if (decoration === \"reverse\") {\n                    // when reversing, missing colors are defaulted to black (bg) and white (fg)\n                    if (!jsonChunk.fg) {\n                        jsonChunk.fg = ANSI_COLORS[0][7][use_classes ? \"class\" : \"color\"];\n                    }\n                    if (!jsonChunk.bg) {\n                        jsonChunk.bg = ANSI_COLORS[0][0][use_classes ? \"class\" : \"color\"];\n                    }\n                    var tmpFg = jsonChunk.fg;\n                    jsonChunk.fg = jsonChunk.bg;\n                    jsonChunk.bg = tmpFg;\n                    var tmpFgTrue = jsonChunk.fg_truecolor;\n                    jsonChunk.fg_truecolor = jsonChunk.bg_truecolor;\n                    jsonChunk.bg_truecolor = tmpFgTrue;\n                    jsonChunk.isInverted = true;\n                    return false;\n                }\n                return true;\n            });\n\n            if (options.json) {\n                return jsonChunk;\n            }\n            if (jsonChunk.isEmpty()) {\n                return \"\";\n            }\n            if (!jsonChunk.was_processed) {\n                return jsonChunk.content;\n            }\n\n            var colors = [];\n            var decorations = [];\n            var textDecorations = [];\n            var data = {};\n\n            var render_data = function render_data(data) {\n                var fragments = [];\n                var key = void 0;\n                for (key in data) {\n                    if (data.hasOwnProperty(key)) {\n                        fragments.push(\"data-\" + key + \"=\\\"\" + _this2.escapeForHtml(data[key]) + \"\\\"\");\n                    }\n                }\n                return fragments.length > 0 ? \" \" + fragments.join(\" \") : \"\";\n            };\n\n            if (jsonChunk.isInverted) {\n                data[\"ansi-is-inverted\"] = \"true\";\n            }\n\n            if (jsonChunk.fg) {\n                if (use_classes) {\n                    colors.push(jsonChunk.fg + \"-fg\");\n                    if (jsonChunk.fg_truecolor !== null) {\n                        data[\"ansi-truecolor-fg\"] = jsonChunk.fg_truecolor;\n                        jsonChunk.fg_truecolor = null;\n                    }\n                } else {\n                    colors.push(\"color:rgb(\" + jsonChunk.fg + \")\");\n                }\n            }\n\n            if (jsonChunk.bg) {\n                if (use_classes) {\n                    colors.push(jsonChunk.bg + \"-bg\");\n                    if (jsonChunk.bg_truecolor !== null) {\n                        data[\"ansi-truecolor-bg\"] = jsonChunk.bg_truecolor;\n                        jsonChunk.bg_truecolor = null;\n                    }\n                } else {\n                    colors.push(\"background-color:rgb(\" + jsonChunk.bg + \")\");\n                }\n            }\n\n            jsonChunk.decorations.forEach(function (decoration) {\n                // use classes\n                if (use_classes) {\n                    decorations.push(\"ansi-\" + decoration);\n                    return;\n                }\n                // use styles\n                if (decoration === \"bold\") {\n                    decorations.push(\"font-weight:bold\");\n                } else if (decoration === \"dim\") {\n                    decorations.push(\"opacity:0.5\");\n                } else if (decoration === \"italic\") {\n                    decorations.push(\"font-style:italic\");\n                } else if (decoration === \"hidden\") {\n                    decorations.push(\"visibility:hidden\");\n                } else if (decoration === \"strikethrough\") {\n                    textDecorations.push(\"line-through\");\n                } else {\n                    // underline and blink are treated here\n                    textDecorations.push(decoration);\n                }\n            });\n\n            if (textDecorations.length) {\n                decorations.push(\"text-decoration:\" + textDecorations.join(\" \"));\n            }\n\n            if (use_classes) {\n                return \"<span class=\\\"\" + colors.concat(decorations).join(\" \") + \"\\\"\" + render_data(data) + \">\" + jsonChunk.content + \"</span>\";\n            } else {\n                return \"<span style=\\\"\" + colors.concat(decorations).join(\";\") + \"\\\"\" + render_data(data) + \">\" + jsonChunk.content + \"</span>\";\n            }\n        }\n    }, {\n        key: \"removeDecoration\",\n        value: function removeDecoration(decoration) {\n            var index = this.decorations.indexOf(decoration);\n\n            if (index >= 0) {\n                this.decorations.splice(index, 1);\n            }\n        }\n    }]);\n\n    return Anser;\n}();\n\nmodule.exports = Anser;","/**\n * Escape carrigage returns like a terminal\n * @param {string} txt - String to escape.\n * @return {string}    - Escaped string.\n */\nfunction escapeCarriageReturn(txt) {\n  if (!txt) return \"\";\n  if (!/\\r/.test(txt)) return txt;\n  txt = txt.replace(/\\r+\\n/gm, \"\\n\"); // \\r followed by \\n --> newline\n  while (/\\r./.test(txt)) {\n    txt = txt.replace(/^([^\\r\\n]*)\\r+([^\\r\\n]+)/gm, function (_, base, insert) {\n      return insert + base.slice(insert.length);\n    });\n  }\n  return txt;\n}\n\nfunction findLongestString(arr) {\n  var longest = 0;\n  for (var i = 0; i < arr.length; i++) {\n    if (arr[longest].length <= arr[i].length) {\n      longest = i;\n    }\n  }\n  return longest;\n}\n\nfunction escapeSingleLineSafe(txt) {\n  if (!/\\r/.test(txt)) return txt;\n  var arr = txt.split(\"\\r\");\n  var res = [];\n\n  while (arr.length > 0) {\n    var longest = findLongestString(arr);\n    res.push(arr[longest]);\n    arr = arr.slice(longest + 1);\n  }\n\n  return res.join(\"\\r\");\n}\n\n/**\n * Safely escape carrigage returns like a terminal.\n * This allows to escape carrigage returns while allowing future output to be appended\n * without loosing information.\n * Use this as a intermediate escape step if your stream hasn't completed yet.\n * @param {string} txt - String to escape.\n * @return {string}    - Escaped string.\n */\nfunction escapeCarriageReturnSafe(txt) {\n  if (!txt) return \"\";\n  if (!/\\r/.test(txt)) return txt;\n  if (!/\\n/.test(txt)) return escapeSingleLineSafe(txt);\n  txt = txt.replace(/\\r+\\n/gm, \"\\n\"); // \\r followed by \\n --> newline\n  var idx = txt.lastIndexOf(\"\\n\");\n\n  return (\n    escapeCarriageReturn(txt.slice(0, idx)) +\n    \"\\n\" +\n    escapeSingleLineSafe(txt.slice(idx + 1))\n  );\n}\n\nmodule.exports = escapeCarriageReturn;\nmodule.exports.escapeCarriageReturn = escapeCarriageReturn;\nmodule.exports.escapeCarriageReturnSafe = escapeCarriageReturnSafe;\n","import Anser, { AnserJsonEntry } from \"anser\";\nimport { escapeCarriageReturn } from \"escape-carriage\";\nimport * as React from \"react\";\nimport styles from \"./Terminal.module.css\";\n\n/**\n * Source:\n * https://github.com/nteract/ansi-to-react/blob/master/src/index.ts\n */\n\n/**\n * Converts ANSI strings into JSON output.\n * @param input - The input string.\n * @param useClasses - If `true`, HTML classes will be appended\n *                              to the HTML output.\n * @returns The parsed input.\n */\nfunction ansiToJSON(input: string, useClasses: boolean | undefined): AnserJsonEntry[] {\n\tinput = escapeCarriageReturn(fixBackspace(input));\n\treturn Anser.ansiToJson(input, {\n\t\tjson: true,\n\t\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\t\t\"remove_empty\": true,\n\t\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\t\t\"use_classes\": useClasses,\n\t});\n}\n\n/**\n * Create a class string.\n * @returns class name(s)\n */\nfunction createClass(bundle: AnserJsonEntry): string | null {\n\tconst classNames = [];\n\n\tif (bundle.bg) {\n\t\tclassNames.push(styles[`${bundle.bg}-bg`]);\n\t}\n\tif (bundle.fg) {\n\t\tclassNames.push(styles[`${bundle.fg}-fg`]);\n\t}\n\tif (bundle.decoration) {\n\t\tclassNames.push(styles[`ansi-${bundle.decoration}`]);\n\t}\n\n\tif (classNames.length === 0) {\n\t\treturn null;\n\t}\n\n\treturn classNames.join(\" \");\n}\n\n/**\n * Create the style attribute.\n * @param bundle\n * @returns returns the style object\n */\nfunction createStyle(bundle: AnserJsonEntry): object {\n\tconst style: Record<string, string> = {};\n\tif (bundle.bg) {\n\t\tstyle.backgroundColor = `rgb(${bundle.bg})`;\n\t}\n\tif (bundle.fg) {\n\t\tstyle.color = `rgb(${bundle.fg})`;\n\t}\n\tswitch (bundle.decoration) {\n\t\tcase \"bold\":\n\t\t\tstyle.fontWeight = \"bold\";\n\t\t\tbreak;\n\t\tcase \"dim\":\n\t\t\tstyle.opacity = \"0.5\";\n\t\t\tbreak;\n\t\tcase \"italic\":\n\t\t\tstyle.fontStyle = \"italic\";\n\t\t\tbreak;\n\t\tcase \"hidden\":\n\t\t\tstyle.visibility = \"hidden\";\n\t\t\tbreak;\n\t\tcase \"strikethrough\":\n\t\t\tstyle.textDecoration = \"line-through\";\n\t\t\tbreak;\n\t\tcase \"underline\":\n\t\t\tstyle.textDecoration = \"underline\";\n\t\t\tbreak;\n\t\tcase \"blink\":\n\t\t\tstyle.textDecoration = \"blink\";\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn style;\n}\n\n/**\n * Converts an Anser bundle into a React Node.\n * @param linkify - whether links should be converting into clickable anchor tags.\n * @param useClasses - should render the span with a class instead of style.\n * @param bundle - Anser output.\n */\nfunction convertBundleIntoReact(linkify: boolean, useClasses: boolean, bundle: AnserJsonEntry, key: number) {\n\tconst style = useClasses ? null : createStyle(bundle);\n\tconst className = useClasses ? createClass(bundle) : null;\n\n\tif (!linkify) {\n\t\treturn React.createElement(\n\t\t\t\"pre\",\n\t\t\t{ style, key, className },\n\t\t\tbundle.content\n\t\t);\n\t}\n\n\tconst content = [];\n\tconst linkRegex = /(\\s|^)(https?:\\/\\/(?:www\\.|(?!www))[^\\s.]+\\.[^\\s]{2,}|www\\.[^\\s]+\\.[^\\s]{2,})/g;\n\n\tlet index = 0;\n\tlet match: RegExpExecArray | null;\n\twhile ((match = linkRegex.exec(bundle.content)) !== null) {\n\t\tconst [, pre, url] = match;\n\n\t\tconst startIndex = match.index + pre.length;\n\t\tif (startIndex > index) {\n\t\t\tcontent.push(bundle.content.substring(index, startIndex));\n\t\t}\n\n\t\t// Make sure the href we generate from the link is fully qualified. We assume http\n\t\t// if it starts with a www because many sites don't support https\n\t\tconst href = url.startsWith(\"www.\") ? `http://${url}` : url;\n\t\tcontent.push(\n\t\t\tReact.createElement(\n\t\t\t\t\"a\",\n\t\t\t\t{\n\t\t\t\t\tkey: index,\n\t\t\t\t\thref,\n\t\t\t\t\ttarget: \"_blank\",\n\t\t\t\t},\n\t\t\t\t`${url}`\n\t\t\t)\n\t\t);\n\n\t\tindex = linkRegex.lastIndex;\n\t}\n\n\tif (index < bundle.content.length) {\n\t\tcontent.push(bundle.content.substring(index));\n\t}\n\n\treturn React.createElement(\"span\", { style, key, className }, content);\n}\n\nexport function Ansi(props: { children?: string | undefined; linkify?: boolean | undefined; className?: string | undefined; useClasses?: boolean | undefined; }) {\n\tconst { className, useClasses, children, linkify } = props;\n\treturn React.createElement(\n\t\t\"code\",\n\t\t{ className },\n\t\tansiToJSON(children ?? \"\", useClasses ?? false).map(\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n\t\t\tconvertBundleIntoReact.bind(null, linkify ?? false, useClasses ?? false)\n\t\t)\n\t);\n}\n\n// This is copied from the Jupyter Classic source code\n// notebook/static/base/js/utils.js to handle \\b in a way\n// that is **compatible with Jupyter classic**.   One can\n// argue that this behavior is questionable:\n//   https://stackoverflow.com/questions/55440152/multiple-b-doesnt-work-as-expected-in-jupyter#\nfunction fixBackspace(txt: string) {\n\tlet tmp = txt;\n\tdo {\n\t\ttxt = tmp;\n\t\t// Cancel out anything-but-newline followed by backspace\n\t\t// eslint-disable-next-line no-control-regex\n\t\ttmp = txt.replace(/[^\\n]\\x08/gm, \"\");\n\t} while (tmp.length < txt.length);\n\treturn txt;\n}\n","import { FC, forwardRef } from \"react\";\nimport { Ansi } from \"./Ansi\";\nimport styles from \"./Terminal.module.css\";\n\ninterface OutputLineProps {\n\ttext?: string;\n}\n\nexport const OutputLine: FC<OutputLineProps> = forwardRef<HTMLDivElement>(({ text }: OutputLineProps, ref) => {\n\tconst lines = text?.split(\"\\n\");\n\n\treturn <div ref={ref}>\n\t\t{lines?.map((line, index) =>\n\t\t\t<Ansi key={index} className={styles.Output} useClasses>{line === \"\" ? \" \" : line}</Ansi>\n\t\t)}\n\t</div>;\n}) as FC;","import { ChangeEvent, CSSProperties, KeyboardEvent, MutableRefObject, useState } from \"react\";\nimport styles from \"./Terminal.module.css\";\nimport { Ansi } from \"./Ansi\";\n\n\ninterface InputLineProps {\n\tvalue: string;\n\tprefix: string;\n\tonChange: (event: ChangeEvent) => void;\n\tonKeyUp?: (event: KeyboardEvent) => void;\n\tonKeyDown?: (event: KeyboardEvent) => void;\n\tinputRef: MutableRefObject<HTMLInputElement>;\n}\n\nexport function InputLine({ value, prefix, onChange, onKeyUp, onKeyDown, inputRef }: InputLineProps) {\n\tconst [cursorPosition, setCursorPosition] = useState(0);\n\n\tconst checkCursorPosition = () => {\n\t\tconst selectionStart = inputRef.current?.selectionStart;\n\t\tif (selectionStart != null)\tsetCursorPosition(selectionStart);\n\t};\n\n\treturn (\n\t\t<span className={styles.Input}>\n\t\t\t{prefix && <Ansi className={styles.Prefix} useClasses>{prefix}</Ansi>}\n\t\t\t<span className={styles[\"Input-container\"]} style={{ \"--cursor-offset\": cursorPosition } as CSSProperties}>\n\t\t\t\t<span aria-hidden=\"true\">{value}</span>\n\t\t\t\t<input\n\t\t\t\t\tid=\"input\"\n\t\t\t\t\tvalue={value}\n\t\t\t\t\taria-label=\"Command input\"\n\t\t\t\t\tonChange={(event) => {\n\t\t\t\t\t\tonChange(event);\n\t\t\t\t\t\tcheckCursorPosition();\n\t\t\t\t\t}}\n\t\t\t\t\tref={inputRef}\n\t\t\t\t\tonKeyUp={(event) => { onKeyUp?.(event); }}\n\t\t\t\t\tonKeyDown={(event) => {\n\t\t\t\t\t\tonKeyDown?.(event);\n\t\t\t\t\t\tcheckCursorPosition();\n\t\t\t\t\t}}\n\t\t\t\t\tonClick={checkCursorPosition}\n\t\t\t\t\tonTouchEnd={checkCursorPosition}\n\t\t\t\t\tonSelect={checkCursorPosition}\n\t\t\t\t\tonCut={checkCursorPosition}\n\t\t\t\t\tonCopy={checkCursorPosition}\n\t\t\t\t\tonPaste={checkCursorPosition}\n\t\t\t\t\tspellCheck={false}\n\t\t\t\t\tautoComplete=\"off\"\n\t\t\t\t\tautoFocus\n\t\t\t\t/>\n\t\t\t</span>\n\t\t</span>\n\t);\n}","import { ANSI } from \"@prozilla-os/shared\";\n\nexport const USERNAME = \"user\";\nexport const HOSTNAME = \"prozilla-os\";\nexport const MAX_WIDTH = 50;\n\nexport const WELCOME_MESSAGE = `${ANSI.fg.cyan + ANSI.decoration.dim}$APP_NAME - Made by Prozilla${ANSI.reset}`\n\t+ `\\n${ANSI.decoration.dim}Type 'help' for a list of commands.${ANSI.reset}\\n`;\n\nexport const ASCII_LOGO = `\n              :.           \n             -==.          \n           .=====:         \n   ---::..:=======-.       \n   :===+=----------::..    \n    =+=---------------:..  \n    --------------------:. \n.:-+=----*###*--*####=---. \n:==+----#%+-+%#-##%*+----:.\n  .=----#%+-+%#-*+-%#+---:.\n   ==----*###*--*###*----. \n  ==+-------------------:. \n  ...::---------------:.   \n       .::---------::..    \n          ....::...        `;\n\nexport const ANSI_LOGO_COLOR = ANSI.fg.cyan;\nexport const ANSI_ASCII_LOGO = `\n              :.           \n             -==.          \n           .=====:         \n   ---::..:=======-.       \n   :===+=----------::..    \n    =+=---------------:..  \n    --------------------:. \n.:-+=----${ANSI.fg.white}*###*${ANSI_LOGO_COLOR}--${ANSI.fg.white}*####=${ANSI_LOGO_COLOR}---. \n:==+----${ANSI.fg.white}#%+${ANSI_LOGO_COLOR}-${ANSI.fg.white}+%#${ANSI_LOGO_COLOR}-${ANSI.fg.white}##%*+${ANSI_LOGO_COLOR}----:.\n  .=----${ANSI.fg.white}#%+${ANSI_LOGO_COLOR}-${ANSI.fg.white}+%#${ANSI_LOGO_COLOR}-${ANSI.fg.white}*+${ANSI_LOGO_COLOR}-${ANSI.fg.white}%#+${ANSI_LOGO_COLOR}---:.\n   ==----${ANSI.fg.white}*###*${ANSI_LOGO_COLOR}--${ANSI.fg.white}*###*${ANSI_LOGO_COLOR}----. \n  ==+-------------------:. \n  ...::---------------:.   \n       .::---------::..    \n          ....::...        `;\n","import { EventEmitter } from \"@prozilla-os/shared\";\n\nconst StreamEvents = {\n\tnew: \"new\",\n\tstart: \"start\",\n\tstop: \"stop\",\n} as const;\n\nexport class Stream extends EventEmitter<typeof StreamEvents> {\n\tstatic EVENT_NAMES = StreamEvents;\n\n\tenabled: boolean = false;\n\n\tstart(callback?: (stream: this) => void): Stream {\n\t\tif (this.enabled)\n\t\t\treturn this;\n\n\t\tcallback?.(this);\n\t\tthis.enabled = true;\n\t\tthis.emit(\"start\");\n\t\treturn this;\n\t}\n\n\tstop(): Stream {\n\t\tif (!this.enabled)\n\t\t\treturn this;\n\n\t\tthis.enabled = false;\n\t\tthis.emit(\"stop\");\n\t\treturn this;\n\t}\n\n\tsend(text: string): Stream {\n\t\tif (this.enabled)\n\t\t\tthis.emit(\"new\", text);\n\t\treturn this;\n\t}\n}","import { ANSI } from \"@prozilla-os/shared\";\n\nexport function formatError(commandName: string, error: string): string {\n\treturn `${ANSI.fg.red}${commandName}: ${error}${ANSI.reset}`;\n}\n\nexport function removeAnsi(string: string): string {\n\t// eslint-disable-next-line no-control-regex\n\treturn string.replace(/\\u001b\\[([0-9]+)m/gm, \"\");\n}","import { Command } from \"./command\";\n\nlet commands: Command[] = [];\n\n// https://vitejs.dev/guide/features.html#glob-import\nconst modules = import.meta.glob(\"./commands/*.ts\");\n\n/**\n * Dynamically import commands\n */\nconst loadCommands = () => {\n\tcommands = [];\n\t\n\tfor (const path in modules) {\n\t\tvoid modules[path]().then((commandModule) => {\n\t\t\tconst commandName = Object.keys(commandModule as Record<string, Command>)[0];\n\n\t\t\tconst command = (commandModule as Record<string, Command>)[commandName];\n\n\t\t\tif (command == null)\n\t\t\t\treturn;\n\n\t\t\tcommand.setName(commandName.toLowerCase());\n\t\t\tcommands.push(command);\n\t\t});\n\t}\n};\n\nloadCommands();\n\nexport class CommandsManager {\n\tstatic COMMANDS = commands;\n\n\tstatic find(name: string): Command | null {\n\t\tlet matchCommand: Command | null = null;\n\n\t\tthis.COMMANDS.forEach((command) => {\n\t\t\tif (command.name === name) {\n\t\t\t\tmatchCommand = command;\n\t\t\t\treturn;\n\t\t\t}\n\t\t});\n\n\t\treturn matchCommand;\n\t}\n\n\tstatic search(pattern: string): Command[] {\n\t\tconst matches = this.COMMANDS.filter((command) => command.name?.match(pattern));\n\t\treturn matches;\n\t}\n\n\tstatic reload() {\n\t\tloadCommands();\n\t\tCommandsManager.COMMANDS = commands;\n\t}\n}","import { MouseEventHandler, MutableRefObject, useEffect, useRef, useState } from \"react\";\nimport styles from \"./Terminal.module.css\";\nimport { OutputLine } from \"./OutputLine\";\nimport { InputLine } from \"./InputLine\";\nimport { App, SettingsManager, useSettingsManager, useSystemManager, useVirtualRoot, VirtualFolder, WindowProps } from \"@prozilla-os/core\";\nimport { HOSTNAME, USERNAME, WELCOME_MESSAGE } from \"../constants/terminal.const\";\nimport { Stream } from \"../core/stream\";\nimport { CommandResponse } from \"../core/command\";\nimport { formatError } from \"../core/_utils/terminal.utils\";\nimport { CommandsManager } from \"../core/commands\";\nimport { ANSI, clamp, removeFromArray } from \"@prozilla-os/shared\";\n\nexport interface TerminalProps extends WindowProps {\n\tpath?: string;\n\tinput?: string;\n}\n\nexport interface HistoryEntry {\n\ttext?: string;\n\tisInput: boolean;\n\tvalue?: string;\n\tclear?: boolean;\n}\n\nexport function Terminal({ app, path: startPath, input, setTitle, close: exit, active, focus }: TerminalProps) {\n\tconst systemManager = useSystemManager();\n\tconst [inputKey, setInputKey] = useState(0);\n\tconst [inputValue, setInputValue] = useState(input ?? \"\");\n\tconst [history, setHistory] = useState<HistoryEntry[]>([{\n\t\ttext: app ? WELCOME_MESSAGE.replace(\"$APP_NAME\", app.name) : WELCOME_MESSAGE,\n\t\tisInput: false,\n\t}]);\n\tconst virtualRoot = useVirtualRoot();\n\tconst [currentDirectory, setCurrentDirectory] = useState<VirtualFolder>(virtualRoot?.navigate(startPath ?? \"~\") as VirtualFolder);\n\tconst inputRef = useRef(null);\n\tconst [historyIndex, setHistoryIndex] = useState(0);\n\tconst [stream, setStream] = useState<Stream | null>(null);\n\tconst [streamOutput, setStreamOutput] = useState<string | null>(null);\n\tconst ref = useRef(null);\n\tconst [streamFocused, setStreamFocused] = useState(false);\n\tconst settingsManager = useSettingsManager();\n\n\tuseEffect(() => {\n\t\tif (currentDirectory != null)\n\t\t\tsetTitle?.(`${USERNAME}@${HOSTNAME}: ${currentDirectory.root ? \"/\" : currentDirectory.path}`);\n\t}, [currentDirectory?.path, currentDirectory?.root, setTitle]);\n\n\tuseEffect(() => {\n\t\tif (!inputRef.current || !active)\n\t\t\treturn;\n\n\t\t(inputRef.current as unknown as HTMLInputElement).focus();\n\t}, [inputRef, active]);\n\n\tconst scrollDown = () => {\n\t\t(ref.current as unknown as HTMLDivElement).scrollTop = (ref.current as unknown as HTMLDivElement).scrollHeight;\n\t};\n\n\tuseEffect(() => {\n\t\tif (streamFocused || ref.current == null || streamOutput == null)\n\t\t\treturn;\n\n\t\tscrollDown();\n\t\tsetStreamFocused(true);\n\t}, [streamFocused, streamOutput, ref]);\n\n\tuseEffect(() => {\n\t\tif (ref.current == null || stream != null)\n\t\t\treturn;\n\n\t\tscrollDown();\n\t}, [inputValue]);\n\n\tconst prefix = `${ANSI.fg.cyan + USERNAME}@${HOSTNAME + ANSI.reset}:`\n\t\t+ `${ANSI.fg.blue + ((currentDirectory?.root || currentDirectory == null) ? \"/\" : currentDirectory?.path) + ANSI.reset}$ `;\n\n\tconst updatedHistory = history;\n\tconst pushHistory = (entry: HistoryEntry) => {\n\t\tupdatedHistory.push(entry);\n\t\tsetHistory(updatedHistory);\n\t};\n\n\tconst promptOutput = (text: string) => {\n\t\tpushHistory({\n\t\t\ttext,\n\t\t\tisInput: false,\n\t\t});\n\t};\n\n\tconst connectStream = (stream: Stream, pipes: string[]) => {\n\t\tsetStream(stream);\n\t\tsetStreamFocused(false);\n\n\t\tconst onKeyDown = (event: KeyboardEvent) => {\n\t\t\tif (active && (event.ctrlKey || event.metaKey) && event.key === \"c\") {\n\t\t\t\tstream.stop();\n\t\t\t}\n\t\t};\n\n\t\tlet lastOutput: CommandResponse | null = null;\n\n\t\tstream.on(Stream.EVENT_NAMES.new, (text) => {\n\t\t\tvoid (async () => {\n\t\t\t\tlet output: CommandResponse = text as CommandResponse;\n\n\t\t\t\tfor (const pipe of pipes) {\n\t\t\t\t\tif (output instanceof Stream)\n\t\t\t\t\t\tcontinue;\n\t\t\n\t\t\t\t\t// Output from the previous command gets added as an argument for the next command\n\t\t\t\t\toutput = await handleInput(output ? `${pipe} ${output as string}` : pipe);\n\t\t\t\t}\n\n\t\t\t\tif ((output as unknown) instanceof Stream) {\n\t\t\t\t\tstream.stop();\n\t\t\t\t\tpromptOutput(ANSI.fg.red + \"Stream failed\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlastOutput = output;\n\t\t\t\tsetStreamOutput(output as string);\n\t\t\t})();\n\t\t});\n\n\t\tstream.on(Stream.EVENT_NAMES.stop, () => {\n\t\t\tdocument.removeEventListener(\"keydown\", onKeyDown);\n\n\t\t\tpromptOutput(lastOutput as string);\n\n\t\t\tsetStream(null);\n\t\t\tsetStreamOutput(null);\n\t\t});\n\t\t\n\t\tdocument.addEventListener(\"keydown\", onKeyDown);\n\t};\n\n\tconst handleInput = async (value: string): Promise<CommandResponse> => {\n\t\tconst rawInputValueStart = value.indexOf(\" \") + 1;\n\t\tconst rawInputValue = rawInputValueStart <= 0 ? \"\" : value.substr(rawInputValueStart);\n\t\tconst timestamp = Date.now();\n\n\t\tvalue = value.trim();\n\t\tif (value === \"\") return;\n\n\t\t// Parse arguments\n\t\tlet args: string[] | null = value.match(/(?:[^\\s\"]+|\"[^\"]*\")+/g);\n\t\tif (args == null) return;\n\t\tif (args[0].toLowerCase() === \"sudo\" && args.length >= 2) args.shift();\n\n\t\t// Get command\n\t\tconst commandName = args.shift()?.toLowerCase();\n\t\tif (commandName == null) return;\n\t\tconst command = CommandsManager.find(commandName);\n\n\t\tif (!command) return formatError(commandName, \"Command not found\");\n\n\t\targs = args.map((arg) => {\n\t\t\tif (arg.startsWith(\"\\\"\") && arg.endsWith(\"\\\"\"))\n\t\t\t\treturn arg.slice(1, -1);\n\n\t\t\treturn arg;\n\t\t});\n\n\t\t// Get options\n\t\tconst options: string[] = [];\n\t\tconst inputs: Record<string, string> = {};\n\t\targs.filter((arg: string) => arg.startsWith(\"-\")).forEach((option: string) => {\n\t\t\tconst addOption = (key: string) => {\n\t\t\t\tif (options.includes(key))\n\t\t\t\t\treturn;\n\n\t\t\t\toptions.push(key);\n\t\t\t\tconst commandOption = command.getOption(options[options.length - 1]);\n\n\t\t\t\tif (commandOption?.isInput) {\n\t\t\t\t\tconst optionInput = args[args.indexOf(option) + 1];\n\t\t\t\t\tinputs[commandOption.short] = optionInput;\n\t\t\t\t\tremoveFromArray(optionInput, args);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tif (option.startsWith(\"--\")) {\n\t\t\t\tconst longOption = option.substring(2).toLowerCase();\n\t\t\t\taddOption(longOption);\n\t\t\t} else {\n\t\t\t\tconst shortOptions = option.substring(1).split(\"\");\n\t\t\t\tshortOptions.forEach((shortOption: string) => {\n\t\t\t\t\taddOption(shortOption);\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tremoveFromArray(option, args);\n\t\t});\n\n\t\t// Check usage\n\t\tif (command.requireArgs && args.length === 0)\n\t\t\treturn formatError(commandName, `Incorrect usage: ${commandName} requires at least 1 argument`);\n\n\t\tif (command.requireOptions && options.length === 0)\n\t\t\treturn formatError(commandName, `Incorrect usage: ${commandName} requires at least 1 option`);\n\t\t\n\t\t// Execute command\n\t\tlet response: CommandResponse | null = null;\n\n\t\ttry {\n\t\t\tresponse = await command.execute(args, {\n\t\t\t\tpromptOutput,\n\t\t\t\tpushHistory,\n\t\t\t\tvirtualRoot,\n\t\t\t\tcurrentDirectory: currentDirectory,\n\t\t\t\tsetCurrentDirectory,\n\t\t\t\tusername: USERNAME,\n\t\t\t\thostname: HOSTNAME,\n\t\t\t\trawInputValue,\n\t\t\t\toptions,\n\t\t\t\texit,\n\t\t\t\tinputs,\n\t\t\t\ttimestamp,\n\t\t\t\tsettingsManager: settingsManager as SettingsManager,\n\t\t\t\tsystemManager,\n\t\t\t\tapp: app as App,\n\t\t\t});\n\n\t\t\tif (response == null)\n\t\t\t\treturn formatError(commandName, \"Command failed\");\n\t\t\t\n\t\t\tif (!(response as { blank: boolean }).blank)\n\t\t\t\treturn response;\n\t\t} catch (error) {\n\t\t\tconsole.error(error);\n\t\t\treturn formatError(commandName, \"Command failed\");\n\t\t}\n\t};\n\n\tconst resetInput = () => {\n\t\tsetInputValue(\"\");\n\t\tsetHistoryIndex(0);\n\t};\n\n\tconst submitInput = async (value: string) => {\n\t\tpushHistory({\n\t\t\ttext: prefix + value,\n\t\t\tisInput: true,\n\t\t\tvalue,\n\t\t});\n\n\t\t// Piping is used to chain commands\n\t\tlet pipes = value.split(\" | \");\n\t\tconst completedPipes: string[] = [];\n\n\t\tlet output: CommandResponse | null = null;\n\t\tfor (const pipe of pipes) {\n\t\t\tif (output instanceof Stream)\n\t\t\t\tcontinue;\n\n\t\t\t// Output from the previous command gets added as an argument for the next command\n\t\t\toutput = await handleInput(output ? `${pipe} ${output as string}` : pipe);\n\t\t\tcompletedPipes.push(pipe);\n\t\t}\n\n\t\tresetInput();\n\n\t\tpipes = pipes.filter((pipe) => !completedPipes.includes(pipe));\n\n\t\tif (output) {\n\t\t\tif (output instanceof Stream) {\n\t\t\t\tconnectStream(output, pipes);\n\t\t\t} else {\n\t\t\t\tpromptOutput(`${output as string}\\n`);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst updateHistoryIndex = (delta: number) => {\n\t\tconst inputHistory = history.filter(({ isInput }) => isInput);\n\t\tconst index = clamp(historyIndex + delta, 0, inputHistory.length);\n\n\t\tif (index === historyIndex) {\n\t\t\tif (delta < 0) {\n\t\t\t\tsetInputValue(\"\");\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (index === 0) {\n\t\t\tsetInputValue(\"\");\n\t\t} else {\n\t\t\tsetInputValue(inputHistory[inputHistory.length - index].value ?? \"\");\n\t\t}\n\n\t\tsetHistoryIndex(index);\n\t};\n\n\tconst onKeyDown = (event: React.KeyboardEvent) => {\n\t\tconst value = (event.target as HTMLInputElement).value;\n\t\tconst { key } = event;\n\n\t\tif (key === \"Enter\") {\n\t\t\tvoid submitInput(value);\n\t\t\tsetInputKey((previousKey) =>  previousKey + 1);\n\t\t} else if (key === \"ArrowUp\") {\n\t\t\tevent.preventDefault();\n\t\t\tupdateHistoryIndex(1);\n\t\t} else if (key === \"ArrowDown\") {\n\t\t\tevent.preventDefault();\n\t\t\tupdateHistoryIndex(-1);\n\t\t} else if (!stream && (event.ctrlKey || event.metaKey) && key === \"c\") {\n\t\t\tsetInputValue((value) => value + \"^C\");\n\t\t}\n\t};\n\n\tconst onChange = (event: React.ChangeEvent) => {\n\t\tconst value = (event.target as HTMLInputElement).value;\n\t\treturn setInputValue(value);\n\t};\n\n\tconst displayHistory = () => {\n\t\tconst visibleHistory = history.slice(-16);\n\t\tlet startIndex = 0;\n\n\t\tvisibleHistory.forEach((entry, index) => {\n\t\t\tif (entry.clear)\n\t\t\t\tstartIndex = index + 1;\n\t\t});\n\n\t\treturn visibleHistory.slice(startIndex).map(({ text }, index) => {\n\t\t\treturn <OutputLine text={text} key={index}/>;\n\t\t});\n\t};\n\n\tconst onMouseDown = (event: MouseEvent) => {\n\t\tfocus?.(event);\n\n\t\tif (event.button === 2) {\n\t\t\tevent.preventDefault();\n\n\t\t\tnavigator.clipboard.readText?.().then((text) => {\n\t\t\t\tsetInputValue(inputValue + text);\n\t\t\t}).catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t});\n\t\t}\n\t};\n\n\tconst onContextMenu = (event: Event) => {\n\t\tevent.preventDefault();\n\t};\n\n\treturn (\n\t\t<div\n\t\t\tref={ref} \n\t\t\tclassName={styles.Terminal}\n\t\t\tonMouseDown={onMouseDown as unknown as MouseEventHandler}\n\t\t\tonContextMenu={onContextMenu as unknown as MouseEventHandler}\n\t\t\tonClick={(event) => {\n\t\t\t\tif (window.getSelection()?.toString() === \"\") {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t(inputRef.current as HTMLInputElement | null)?.focus();\n\t\t\t\t}\n\t\t\t}}\n\t\t>\n\t\t\t{displayHistory()}\n\t\t\t{!stream\n\t\t\t\t? <InputLine\n\t\t\t\t\tkey={inputKey}\n\t\t\t\t\tvalue={inputValue}\n\t\t\t\t\tprefix={prefix}\n\t\t\t\t\tonKeyDown={onKeyDown}\n\t\t\t\t\tonChange={onChange}\n\t\t\t\t\tinputRef={inputRef as unknown as MutableRefObject<HTMLInputElement>}\n\t\t\t\t/>\n\t\t\t\t: <OutputLine text={streamOutput ?? \"\"}/>\n\t\t\t}\n\t\t</div>\n\t);\n}","import { App, AppsConfig } from \"@prozilla-os/core\";\nimport { Terminal, TerminalProps } from \"./components/Terminal\";\n\nconst terminal = new App<TerminalProps>(\"Terminal\", \"terminal\", Terminal)\n\t.setIconUrl(\"https://os.prozilla.dev/assets/apps/icons/terminal.svg\")\n\t.setRole(AppsConfig.APP_ROLES.terminal)\n\t.setCategory(\"Utilities & tools\");\nterminal.setMetadata({ name: \"@prozilla-os/terminal\", version: \"1.1.18\", author: \"Prozilla\" });\n\n\nexport { terminal };"],"names":["_createClass","defineProperties","target","props","i","descriptor","Constructor","protoProps","staticProps","_classCallCheck","instance","ANSI_COLORS","linkRegex","Anser","txt","options","j","levels","format","r","g","b","_r","_g","_b","level","_i","str","markup","_this","self","raw_text_chunks","first_chunk","color_chunks","chunk","first","c","text","use_classes","key","result","matches","nums","num_str","num","is_foreground","mode","palette_index","klass","color","_this2","jsonChunk","decoration","tmpFg","tmpFgTrue","colors","decorations","textDecorations","data","render_data","fragments","index","lib","escapeCarriageReturn","_","base","insert","findLongestString","arr","longest","escapeSingleLineSafe","res","escapeCarriageReturnSafe","idx","escapeCarriageModule","escapeCarriageReturn_1","ansiToJSON","input","useClasses","fixBackspace","createClass","bundle","classNames","styles","createStyle","style","convertBundleIntoReact","linkify","className","React","content","match","pre","url","startIndex","href","Ansi","children","tmp","OutputLine","forwardRef","ref","lines","jsx","line","InputLine","value","prefix","onChange","onKeyUp","onKeyDown","inputRef","cursorPosition","setCursorPosition","useState","checkCursorPosition","selectionStart","_a","jsxs","event","USERNAME","HOSTNAME","MAX_WIDTH","WELCOME_MESSAGE","ANSI","ANSI_LOGO_COLOR","ANSI_ASCII_LOGO","StreamEvents","Stream","EventEmitter","__publicField","callback","formatError","commandName","error","removeAnsi","string","commands","modules","loadCommands","path","commandModule","command","_CommandsManager","name","matchCommand","pattern","CommandsManager","Terminal","app","startPath","setTitle","exit","active","focus","systemManager","useSystemManager","inputKey","setInputKey","inputValue","setInputValue","history","setHistory","virtualRoot","useVirtualRoot","currentDirectory","setCurrentDirectory","useRef","historyIndex","setHistoryIndex","stream","setStream","streamOutput","setStreamOutput","streamFocused","setStreamFocused","settingsManager","useSettingsManager","useEffect","scrollDown","updatedHistory","pushHistory","entry","promptOutput","connectStream","pipes","lastOutput","output","pipe","handleInput","rawInputValueStart","rawInputValue","timestamp","args","arg","inputs","option","addOption","commandOption","optionInput","removeFromArray","longOption","shortOption","response","resetInput","submitInput","completedPipes","updateHistoryIndex","delta","inputHistory","isInput","clamp","previousKey","displayHistory","visibleHistory","onMouseDown","onContextMenu","terminal","App","AppsConfig"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA,IAAIA,KAAe,2BAAY;AAAE,WAASC,EAAiBC,GAAQC,GAAO;AAAE,aAASC,IAAI,GAAGA,IAAID,EAAM,QAAQC,KAAK;AAAE,UAAIC,IAAaF,EAAMC,CAAC;AAAG,MAAAC,EAAW,aAAaA,EAAW,cAAc,IAAOA,EAAW,eAAe,IAAU,WAAWA,MAAYA,EAAW,WAAW,KAAM,OAAO,eAAeH,GAAQG,EAAW,KAAKA,CAAU;AAAA,IAAE;AAAA,EAAI;AAAC,SAAO,SAAUC,GAAaC,GAAYC,GAAa;AAAE,WAAID,KAAYN,EAAiBK,EAAY,WAAWC,CAAU,GAAOC,KAAaP,EAAiBK,GAAaE,CAAW,GAAUF;AAAA,EAAc;AAAG,EAAA;AAEjjB,SAASG,GAAgBC,GAAUJ,GAAa;AAAE,MAAI,EAAEI,aAAoBJ;AAAgB,UAAM,IAAI,UAAU,mCAAmC;AAAM;AAEzJ,IAAIK,IAAc,CAAC,CAAC,EAAE,OAAO,WAAW,OAAS,aAAY,GAAI,EAAE,OAAO,aAAa,OAAS,WAAY,GAAE,EAAE,OAAO,aAAa,OAAS,aAAc,GAAE,EAAE,OAAO,eAAe,OAAS,iBAAiB,EAAE,OAAO,aAAa,OAAS,eAAe,EAAE,OAAO,eAAe,OAAS,eAAc,GAAI,EAAE,OAAO,eAAe,OAAS,YAAa,GAAE,EAAE,OAAO,eAAe,OAAS,aAAY,CAAE,GAAG,CAAC,EAAE,OAAO,cAAc,OAAS,oBAAmB,GAAI,EAAE,OAAO,eAAe,OAAS,kBAAmB,GAAE,EAAE,OAAO,aAAa,OAAS,oBAAmB,GAAI,EAAE,OAAO,gBAAgB,OAAS,qBAAsB,GAAE,EAAE,OAAO,eAAe,OAAS,mBAAoB,GAAE,EAAE,OAAO,gBAAgB,OAAS,yBAAyB,EAAE,OAAO,gBAAgB,OAAS,mBAAkB,GAAI,EAAE,OAAO,iBAAiB,OAAS,oBAAqB,CAAA,CAAC,GAE/0BC,KAAY,+EAEZC,KAAQ,WAAY;AACpB,EAAAb,GAAaa,GAAO,MAAM,CAAC;AAAA,IACvB,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAgBL,OAAO,SAAuBC,GAAK;AAC/B,aAAO,IAAID,EAAK,EAAG,cAAcC,CAAG;AAAA,IACvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAeT,GAAO;AAAA,IACC,KAAK;AAAA,IACL,OAAO,SAAiBA,GAAK;AACzB,aAAO,IAAID,EAAK,EAAG,QAAQC,CAAG;AAAA,IACjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA2BT,GAAO;AAAA,IACC,KAAK;AAAA,IACL,OAAO,SAAoBA,GAAKC,GAAS;AACrC,aAAO,IAAIF,EAAO,EAAC,WAAWC,GAAKC,CAAO;AAAA,IAC7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaT,GAAO;AAAA,IACC,KAAK;AAAA,IACL,OAAO,SAAoBD,GAAKC,GAAS;AACrC,aAAO,IAAIF,EAAO,EAAC,WAAWC,GAAKC,CAAO;AAAA,IAC7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYT,GAAO;AAAA,IACC,KAAK;AAAA,IACL,OAAO,SAAoBD,GAAK;AAC5B,aAAO,IAAID,EAAK,EAAG,WAAWC,CAAG;AAAA,IACpC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWJ,CAAA,CAAC;AAEF,WAASD,IAAQ;AACb,IAAAJ,GAAgB,MAAMI,CAAK,GAE3B,KAAK,KAAK,KAAK,KAAK,KAAK,eAAe,KAAK,eAAe,MAC5D,KAAK,SAAS,GACd,KAAK,cAAc;EACtB;AAWD,SAAAb,GAAaa,GAAO,CAAC;AAAA,IACjB,KAAK;AAAA,IACL,OAAO,WAAwB;AAC3B,WAAK,iBAAiB;AAGtB,eAAST,IAAI,GAAGA,IAAI,GAAG,EAAEA;AACrB,iBAASY,IAAI,GAAGA,IAAI,GAAG,EAAEA;AACrB,eAAK,eAAe,KAAKL,EAAYP,CAAC,EAAEY,CAAC,EAAE,KAAK;AAaxD,eAPIC,IAAS,CAAC,GAAG,IAAI,KAAK,KAAK,KAAK,GAAG,GACnCC,IAAS,SAAgBC,GAAGC,GAAGC,GAAG;AAClC,eAAOJ,EAAOE,CAAC,IAAI,OAAOF,EAAOG,CAAC,IAAI,OAAOH,EAAOI,CAAC;AAAA,MACrE,GAIqBC,IAAK,GAAGA,IAAK,GAAG,EAAEA;AACvB,iBAASC,IAAK,GAAGA,IAAK,GAAG,EAAEA;AACvB,mBAASC,IAAK,GAAGA,IAAK,GAAG,EAAEA;AACvB,iBAAK,eAAe,KAAKN,EAAOI,GAAIC,GAAIC,CAAE,CAAC;AAOvD,eADIC,IAAQ,GACHC,IAAK,GAAGA,IAAK,IAAI,EAAEA,GAAID,KAAS;AACrC,aAAK,eAAe,KAAKP,EAAOO,GAAOA,GAAOA,CAAK,CAAC;AAAA,IAE3D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYT,GAAO;AAAA,IACC,KAAK;AAAA,IACL,OAAO,SAAuBX,GAAK;AAC/B,aAAOA,EAAI,QAAQ,aAAa,SAAUa,GAAK;AAC3C,eAAOA,KAAO,MAAM,UAAUA,KAAO,MAAM,WAAWA,KAAO,MAAM,SAASA,KAAO,MAAM,SAAS;AAAA,MAClH,CAAa;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYT,GAAO;AAAA,IACC,KAAK;AAAA,IACL,OAAO,SAAiBb,GAAK;AACzB,aAAOA,EAAI,QAAQF,IAAW,SAAUe,GAAK;AACzC,eAAO,cAAeA,IAAM,OAAQA,IAAM;AAAA,MAC1D,CAAa;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaT,GAAO;AAAA,IACC,KAAK;AAAA,IACL,OAAO,SAAoBb,GAAKC,GAAS;AACrC,aAAO,KAAK,QAAQD,GAAKC,GAAS,EAAI;AAAA,IACzC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaT,GAAO;AAAA,IACC,KAAK;AAAA,IACL,OAAO,SAAoBD,GAAKC,GAAS;AACrC,aAAAA,IAAUA,KAAW,IACrBA,EAAQ,OAAO,IACfA,EAAQ,YAAY,IACb,KAAK,QAAQD,GAAKC,GAAS,EAAI;AAAA,IACzC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYT,GAAO;AAAA,IACC,KAAK;AAAA,IACL,OAAO,SAAoBD,GAAK;AAC5B,aAAO,KAAK,QAAQA,GAAK,CAAE,GAAE,EAAK;AAAA,IACrC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiBT,GAAO;AAAA,IACC,KAAK;AAAA,IACL,OAAO,SAAiBA,GAAKC,GAASa,GAAQ;AAC1C,UAAIC,IAAQ,MAERC,IAAO,MACPC,IAAkBjB,EAAI,MAAM,QAAQ,GACpCkB,IAAcD,EAAgB;AAElC,MAA6BhB,KAAY,SACrCA,IAAU,CAAA,IAEdA,EAAQ,YAAY,KAAK,KAAKD,CAAG;AACjC,UAAImB,IAAeF,EAAgB,IAAI,SAAUG,GAAO;AACpD,eAAOL,EAAM,aAAaK,GAAOnB,GAASa,CAAM;AAAA,MAChE,CAAa;AAED,UAAIb,KAAWA,EAAQ,MAAM;AACzB,YAAIoB,IAAQL,EAAK,iBAAiB,EAAE;AACpC,eAAAK,EAAM,UAAUH,GAChBG,EAAM,YAAYpB,EAAQ,WAC1BkB,EAAa,QAAQE,CAAK,GACtBpB,EAAQ,iBACRkB,IAAeA,EAAa,OAAO,SAAUG,GAAG;AAC5C,iBAAO,CAACA,EAAE;QAClC,CAAqB,IAEEH;AAAA,MACvB;AACgB,QAAAA,EAAa,QAAQD,CAAW;AAGpC,aAAOC,EAAa,KAAK,EAAE;AAAA,IAC9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA4BT,GAAO;AAAA,IACC,KAAK;AAAA,IACL,OAAO,SAA0BI,GAAMtB,GAASa,GAAQ;AAGpD,MAAAb,IAAU,OAAOA,IAAW,MAAc,CAAA,IAAKA;AAC/C,UAAIuB,IAAcvB,EAAQ,cAAc,OAAOA,EAAQ,cAAe,OAAeA,EAAQ,aACzFwB,IAAMxB,EAAQ,MAAMuB,IAAc,UAAU,SAE5CE,IAAS;AAAA,QACT,SAASH;AAAA,QACT,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,cAAc;AAAA,QACd,cAAc;AAAA,QACd,YAAY;AAAA,QACZ,WAAWtB,EAAQ;AAAA,QACnB,YAAY;AAAA,QACZ,aAAa,CAAE;AAAA,QACf,eAAe;AAAA,QACf,SAAS,WAAmB;AACxB,iBAAO,CAACyB,EAAO;AAAA,QAClB;AAAA,MACjB,GAegBC,IAAUJ,EAAK,MAAM,6DAA6D;AAEtF,UAAI,CAACI,EAAS,QAAOD;AAEN,MAAAA,EAAO,UAAUC,EAAQ,CAAC;AACzC,UAAIC,IAAOD,EAAQ,CAAC,EAAE,MAAM,GAAG;AAQ/B,UAJIA,EAAQ,CAAC,MAAM,MAAMA,EAAQ,CAAC,MAAM,OAIpC,CAACb;AACD,eAAOY;AAKX,eAFIV,IAAO,MAEJY,EAAK,SAAS,KAAG;AACpB,YAAIC,IAAUD,EAAK,SACfE,IAAM,SAASD,CAAO;AAE1B,YAAI,MAAMC,CAAG,KAAKA,MAAQ;AACtB,UAAAd,EAAK,KAAKA,EAAK,KAAK,MACpBA,EAAK,cAAc;iBACZc,MAAQ;AACf,UAAAd,EAAK,YAAY,KAAK,MAAM;AAAA,iBACrBc,MAAQ;AACf,UAAAd,EAAK,YAAY,KAAK,KAAK;AAAA,iBAEpBc,MAAQ;AACf,UAAAd,EAAK,YAAY,KAAK,QAAQ;AAAA,iBACvBc,MAAQ;AACf,UAAAd,EAAK,YAAY,KAAK,WAAW;AAAA,iBAC1Bc,MAAQ;AACf,UAAAd,EAAK,YAAY,KAAK,OAAO;AAAA,iBACtBc,MAAQ;AACf,UAAAd,EAAK,YAAY,KAAK,SAAS;AAAA,iBACxBc,MAAQ;AACf,UAAAd,EAAK,YAAY,KAAK,QAAQ;AAAA,iBAEvBc,MAAQ;AACf,UAAAd,EAAK,YAAY,KAAK,eAAe;AAAA,iBAK9Bc,MAAQ;AACf,UAAAd,EAAK,iBAAiB,MAAM;AAAA,iBACrBc,MAAQ;AACf,UAAAd,EAAK,iBAAiB,MAAM,GAC5BA,EAAK,iBAAiB,KAAK;AAAA,iBACpBc,MAAQ;AACf,UAAAd,EAAK,iBAAiB,QAAQ;AAAA,iBACvBc,MAAQ;AACf,UAAAd,EAAK,iBAAiB,WAAW;AAAA,iBAC1Bc,MAAQ;AACf,UAAAd,EAAK,iBAAiB,OAAO;AAAA,iBACtBc,MAAQ;AACf,UAAAd,EAAK,iBAAiB,SAAS;AAAA,iBACxBc,MAAQ;AACf,UAAAd,EAAK,iBAAiB,QAAQ;AAAA,iBACvBc,MAAQ;AACf,UAAAd,EAAK,iBAAiB,eAAe;AAAA,iBAC9Bc,MAAQ;AACf,UAAAd,EAAK,KAAK;AAAA,iBACHc,MAAQ;AACf,UAAAd,EAAK,KAAK;AAAA,iBAEHc,KAAO,MAAMA,IAAM;AAC1B,UAAAd,EAAK,KAAKnB,EAAY,CAAC,EAAEiC,IAAM,EAAE,EAAEL,CAAG;AAAA,iBAE/BK,KAAO,MAAMA,IAAM;AAC1B,UAAAd,EAAK,KAAKnB,EAAY,CAAC,EAAEiC,IAAM,EAAE,EAAEL,CAAG;AAAA,iBAE/BK,KAAO,MAAMA,IAAM;AAC1B,UAAAd,EAAK,KAAKnB,EAAY,CAAC,EAAEiC,IAAM,EAAE,EAAEL,CAAG;AAAA,iBAE/BK,KAAO,OAAOA,IAAM;AAC3B,UAAAd,EAAK,KAAKnB,EAAY,CAAC,EAAEiC,IAAM,EAAE,EAAEL,CAAG;AAAA,iBAC/BK,MAAQ,MAAMA,MAAQ,IAAI;AAEjC,cAAIC,IAAgBD,MAAQ;AAC5B,cAAIF,EAAK,UAAU,GAAG;AAClB,gBAAII,IAAOJ,EAAK;AAChB,gBAAII,MAAS,OAAOJ,EAAK,UAAU,GAAG;AAElC,kBAAIK,IAAgB,SAASL,EAAK,MAAO,CAAA;AACzC,kBAAIK,KAAiB,KAAKA,KAAiB;AACvC,oBAAI,CAACT;AACD,kBAAK,KAAK,kBACNR,EAAK,aAAY,GAEjBe,IACAf,EAAK,KAAK,KAAK,eAAeiB,CAAa,IAE3CjB,EAAK,KAAK,KAAK,eAAeiB,CAAa;AAAA,qBAE5C;AACH,sBAAIC,IAAQD,KAAiB,KAAK,kBAAkBA,IAAgBpC,EAAYoC,IAAgB,IAAI,IAAI,CAAC,EAAEA,IAAgB,CAAC,EAAE;AAC9H,kBAAIF,IACAf,EAAK,KAAKkB,IAEVlB,EAAK,KAAKkB;AAAA,gBAEjB;AAAA,YAER,WAAUF,MAAS,OAAOJ,EAAK,UAAU,GAAG;AAEzC,kBAAIvB,IAAI,SAASuB,EAAK,MAAO,CAAA,GACzBtB,IAAI,SAASsB,EAAK,MAAO,CAAA,GACzBrB,IAAI,SAASqB,EAAK,MAAO,CAAA;AAC7B,kBAAIvB,KAAK,KAAKA,KAAK,OAAOC,KAAK,KAAKA,KAAK,OAAOC,KAAK,KAAKA,KAAK,KAAK;AAChE,oBAAI4B,IAAQ9B,IAAI,OAAOC,IAAI,OAAOC;AAClC,gBAAKiB,IAOGO,KACAf,EAAK,KAAK,kBACVA,EAAK,eAAemB,MAEpBnB,EAAK,KAAK,kBACVA,EAAK,eAAemB,KAXpBJ,IACAf,EAAK,KAAKmB,IAEVnB,EAAK,KAAKmB;AAAA,cAWrB;AAAA,YACJ;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ;AAED,aAAInB,EAAK,OAAO,QAAQA,EAAK,OAAO,QAAQA,EAAK,YAAY,WAAW,MAOpEU,EAAO,KAAKV,EAAK,IACjBU,EAAO,KAAKV,EAAK,IACjBU,EAAO,eAAeV,EAAK,cAC3BU,EAAO,eAAeV,EAAK,cAC3BU,EAAO,cAAcV,EAAK,aAC1BU,EAAO,aAAaV,EAAK,YAAY,MAAM,EAAE,EAAE,IAAK,KAAI,MACxDU,EAAO,gBAAgB,KAEhBA;AAAA,IAEd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAkBT,GAAO;AAAA,IACC,KAAK;AAAA,IACL,OAAO,SAAsBH,GAAMtB,GAASa,GAAQ;AAChD,UAAIsB,IAAS;AAEb,MAAAnC,IAAUA,KAAW;AACrB,UAAIoC,IAAY,KAAK,iBAAiBd,GAAMtB,GAASa,CAAM,GACvDU,IAAcvB,EAAQ;AAwB1B,UArBAoC,EAAU,cAAcA,EAAU,YAAY,OAAO,SAAUC,GAAY;AACvE,YAAIA,MAAe,WAAW;AAE1B,UAAKD,EAAU,OACXA,EAAU,KAAKxC,EAAY,CAAC,EAAE,CAAC,EAAE2B,IAAc,UAAU,OAAO,IAE/Da,EAAU,OACXA,EAAU,KAAKxC,EAAY,CAAC,EAAE,CAAC,EAAE2B,IAAc,UAAU,OAAO;AAEpE,cAAIe,IAAQF,EAAU;AACtB,UAAAA,EAAU,KAAKA,EAAU,IACzBA,EAAU,KAAKE;AACf,cAAIC,IAAYH,EAAU;AAC1B,iBAAAA,EAAU,eAAeA,EAAU,cACnCA,EAAU,eAAeG,GACzBH,EAAU,aAAa,IAChB;AAAA,QACV;AACD,eAAO;AAAA,MACvB,CAAa,GAEGpC,EAAQ;AACR,eAAOoC;AAEX,UAAIA,EAAU;AACV,eAAO;AAEX,UAAI,CAACA,EAAU;AACX,eAAOA,EAAU;AAGrB,UAAII,IAAS,CAAA,GACTC,IAAc,CAAA,GACdC,IAAkB,CAAA,GAClBC,IAAO,CAAA,GAEPC,IAAc,SAAqBD,GAAM;AACzC,YAAIE,IAAY,CAAA,GACZrB,IAAM;AACV,aAAKA,KAAOmB;AACR,UAAIA,EAAK,eAAenB,CAAG,KACvBqB,EAAU,KAAK,UAAUrB,IAAM,OAAQW,EAAO,cAAcQ,EAAKnB,CAAG,CAAC,IAAI,GAAI;AAGrF,eAAOqB,EAAU,SAAS,IAAI,MAAMA,EAAU,KAAK,GAAG,IAAI;AAAA,MAC1E;AAyDY,aAvDIT,EAAU,eACVO,EAAK,kBAAkB,IAAI,SAG3BP,EAAU,OACNb,KACAiB,EAAO,KAAKJ,EAAU,KAAK,KAAK,GAC5BA,EAAU,iBAAiB,SAC3BO,EAAK,mBAAmB,IAAIP,EAAU,cACtCA,EAAU,eAAe,SAG7BI,EAAO,KAAK,eAAeJ,EAAU,KAAK,GAAG,IAIjDA,EAAU,OACNb,KACAiB,EAAO,KAAKJ,EAAU,KAAK,KAAK,GAC5BA,EAAU,iBAAiB,SAC3BO,EAAK,mBAAmB,IAAIP,EAAU,cACtCA,EAAU,eAAe,SAG7BI,EAAO,KAAK,0BAA0BJ,EAAU,KAAK,GAAG,IAIhEA,EAAU,YAAY,QAAQ,SAAUC,GAAY;AAEhD,YAAId,GAAa;AACb,UAAAkB,EAAY,KAAK,UAAUJ,CAAU;AACrC;AAAA,QACH;AAED,QAAIA,MAAe,SACfI,EAAY,KAAK,kBAAkB,IAC5BJ,MAAe,QACtBI,EAAY,KAAK,aAAa,IACvBJ,MAAe,WACtBI,EAAY,KAAK,mBAAmB,IAC7BJ,MAAe,WACtBI,EAAY,KAAK,mBAAmB,IAC7BJ,MAAe,kBACtBK,EAAgB,KAAK,cAAc,IAGnCA,EAAgB,KAAKL,CAAU;AAAA,MAEnD,CAAa,GAEGK,EAAgB,UAChBD,EAAY,KAAK,qBAAqBC,EAAgB,KAAK,GAAG,CAAC,GAG/DnB,IACO,kBAAmBiB,EAAO,OAAOC,CAAW,EAAE,KAAK,GAAG,IAAI,MAAOG,EAAYD,CAAI,IAAI,MAAMP,EAAU,UAAU,YAE/G,kBAAmBI,EAAO,OAAOC,CAAW,EAAE,KAAK,GAAG,IAAI,MAAOG,EAAYD,CAAI,IAAI,MAAMP,EAAU,UAAU;AAAA,IAE7H;AAAA,EACT,GAAO;AAAA,IACC,KAAK;AAAA,IACL,OAAO,SAA0BC,GAAY;AACzC,UAAIS,IAAQ,KAAK,YAAY,QAAQT,CAAU;AAE/C,MAAIS,KAAS,KACT,KAAK,YAAY,OAAOA,GAAO,CAAC;AAAA,IAEvC;AAAA,EACJ,CAAA,CAAC,GAEKhD;AACX,KAEAiD,KAAiBjD;;;AC1qBjB,SAASkD,GAAqBjD,GAAK;AACjC,MAAI,CAACA,EAAK,QAAO;AACjB,MAAI,CAAC,KAAK,KAAKA,CAAG,EAAG,QAAOA;AAE5B,OADAA,IAAMA,EAAI,QAAQ,WAAW;AAAA,CAAI,GAC1B,MAAM,KAAKA,CAAG;AACnB,IAAAA,IAAMA,EAAI,QAAQ,8BAA8B,SAAUkD,GAAGC,GAAMC,GAAQ;AACzE,aAAOA,IAASD,EAAK,MAAMC,EAAO,MAAM;AAAA,IAC9C,CAAK;AAEH,SAAOpD;AACT;AAEA,SAASqD,GAAkBC,GAAK;AAE9B,WADIC,IAAU,GACLjE,IAAI,GAAGA,IAAIgE,EAAI,QAAQhE;AAC9B,IAAIgE,EAAIC,CAAO,EAAE,UAAUD,EAAIhE,CAAC,EAAE,WAChCiE,IAAUjE;AAGd,SAAOiE;AACT;AAEA,SAASC,GAAqBxD,GAAK;AACjC,MAAI,CAAC,KAAK,KAAKA,CAAG,EAAG,QAAOA;AAI5B,WAHIsD,IAAMtD,EAAI,MAAM,IAAI,GACpByD,IAAM,CAAA,GAEHH,EAAI,SAAS,KAAG;AACrB,QAAIC,IAAUF,GAAkBC,CAAG;AACnC,IAAAG,EAAI,KAAKH,EAAIC,CAAO,CAAC,GACrBD,IAAMA,EAAI,MAAMC,IAAU,CAAC;AAAA,EAC5B;AAED,SAAOE,EAAI,KAAK,IAAI;AACtB;AAUA,SAASC,GAAyB1D,GAAK;AACrC,MAAI,CAACA,EAAK,QAAO;AACjB,MAAI,CAAC,KAAK,KAAKA,CAAG,EAAG,QAAOA;AAC5B,MAAI,CAAC,KAAK,KAAKA,CAAG,EAAG,QAAOwD,GAAqBxD,CAAG;AACpD,EAAAA,IAAMA,EAAI,QAAQ,WAAW;AAAA,CAAI;AACjC,MAAI2D,IAAM3D,EAAI,YAAY;AAAA,CAAI;AAE9B,SACEiD,GAAqBjD,EAAI,MAAM,GAAG2D,CAAG,CAAC,IACtC;AAAA,IACAH,GAAqBxD,EAAI,MAAM2D,IAAM,CAAC,CAAC;AAE3C;AAEAC,GAAc,UAAGX;AACjB,IAAmCY,KAAAD,GAAA,QAAA,uBAAGX;AACtCW,GAAA,QAAA,2BAA0CF;AChD1C,SAASI,GAAWC,GAAeC,GAAmD;AAC7E,SAAAD,IAAAd,GAAqBgB,GAAaF,CAAK,CAAC,GACzChE,GAAM,WAAWgE,GAAO;AAAA,IAC9B,MAAM;AAAA;AAAA,IAEN,cAAgB;AAAA;AAAA,IAEhB,aAAeC;AAAA,EAAA,CACf;AACF;AAMA,SAASE,GAAYC,GAAuC;AAC3D,QAAMC,IAAa,CAAA;AAYf,SAVAD,EAAO,MACVC,EAAW,KAAKC,EAAO,GAAGF,EAAO,EAAE,KAAK,CAAC,GAEtCA,EAAO,MACVC,EAAW,KAAKC,EAAO,GAAGF,EAAO,EAAE,KAAK,CAAC,GAEtCA,EAAO,cACVC,EAAW,KAAKC,EAAO,QAAQF,EAAO,UAAU,EAAE,CAAC,GAGhDC,EAAW,WAAW,IAClB,OAGDA,EAAW,KAAK,GAAG;AAC3B;AAOA,SAASE,GAAYH,GAAgC;AACpD,QAAMI,IAAgC,CAAA;AAOtC,UANIJ,EAAO,OACJI,EAAA,kBAAkB,OAAOJ,EAAO,EAAE,MAErCA,EAAO,OACJI,EAAA,QAAQ,OAAOJ,EAAO,EAAE,MAEvBA,EAAO,YAAY;AAAA,IAC1B,KAAK;AACJ,MAAAI,EAAM,aAAa;AACnB;AAAA,IACD,KAAK;AACJ,MAAAA,EAAM,UAAU;AAChB;AAAA,IACD,KAAK;AACJ,MAAAA,EAAM,YAAY;AAClB;AAAA,IACD,KAAK;AACJ,MAAAA,EAAM,aAAa;AACnB;AAAA,IACD,KAAK;AACJ,MAAAA,EAAM,iBAAiB;AACvB;AAAA,IACD,KAAK;AACJ,MAAAA,EAAM,iBAAiB;AACvB;AAAA,IACD,KAAK;AACJ,MAAAA,EAAM,iBAAiB;AACvB;AAAA,EAGF;AACO,SAAAA;AACR;AAQA,SAASC,GAAuBC,GAAkBT,GAAqBG,GAAwB1C,GAAa;AAC3G,QAAM8C,IAAQP,IAAa,OAAOM,GAAYH,CAAM,GAC9CO,IAAYV,IAAaE,GAAYC,CAAM,IAAI;AAErD,MAAI,CAACM;AACJ,WAAOE,EAAM;AAAA,MACZ;AAAA,MACA,EAAE,OAAAJ,GAAO,KAAA9C,GAAK,WAAAiD,EAAU;AAAA,MACxBP,EAAO;AAAA,IAAA;AAIT,QAAMS,IAAU,CAAA,GACV9E,IAAY;AAElB,MAAIiD,IAAQ,GACR8B;AACJ,UAAQA,IAAQ/E,EAAU,KAAKqE,EAAO,OAAO,OAAO,QAAM;AACzD,UAAM,GAAGW,GAAKC,CAAG,IAAIF,GAEfG,IAAaH,EAAM,QAAQC,EAAI;AACrC,IAAIE,IAAajC,KAChB6B,EAAQ,KAAKT,EAAO,QAAQ,UAAUpB,GAAOiC,CAAU,CAAC;AAKzD,UAAMC,IAAOF,EAAI,WAAW,MAAM,IAAI,UAAUA,CAAG,KAAKA;AAChD,IAAAH,EAAA;AAAA,MACPD,EAAM;AAAA,QACL;AAAA,QACA;AAAA,UACC,KAAK5B;AAAA,UACL,MAAAkC;AAAA,UACA,QAAQ;AAAA,QACT;AAAA,QACA,GAAGF,CAAG;AAAA,MACP;AAAA,IAAA,GAGDhC,IAAQjD,EAAU;AAAA,EACnB;AAEI,SAAAiD,IAAQoB,EAAO,QAAQ,UAC1BS,EAAQ,KAAKT,EAAO,QAAQ,UAAUpB,CAAK,CAAC,GAGtC4B,EAAM,cAAc,QAAQ,EAAE,OAAAJ,GAAO,KAAA9C,GAAK,WAAAiD,KAAaE,CAAO;AACtE;AAEO,SAASM,GAAK7F,GAA4I;AAChK,QAAM,EAAE,WAAAqF,GAAW,YAAAV,GAAY,UAAAmB,GAAU,SAAAV,MAAYpF;AACrD,SAAOsF,EAAM;AAAA,IACZ;AAAA,IACA,EAAE,WAAAD,EAAU;AAAA,IACZZ,GAAWqB,KAAY,IAAInB,KAAc,EAAK,EAAE;AAAA;AAAA,MAE/CQ,GAAuB,KAAK,MAAMC,KAAW,IAAOT,KAAc,EAAK;AAAA,IACxE;AAAA,EAAA;AAEF;AAOA,SAASC,GAAajE,GAAa;AAClC,MAAIoF,IAAMpF;AACP;AACI,IAAAA,IAAAoF,GAGAA,IAAApF,EAAI,QAAQ,eAAe,EAAE;AAAA,SAC3BoF,EAAI,SAASpF,EAAI;AACnB,SAAAA;AACR;ACvKO,MAAMqF,KAAkCC,GAA2B,CAAC,EAAE,MAAA/D,EAAA,GAAyBgE,MAAQ;AACvG,QAAAC,IAAQjE,KAAA,gBAAAA,EAAM,MAAM;AAAA;AAEnB,SAAA,gBAAAkE,EAAC,OAAI,EAAA,KAAAF,GACV,UAAOC,KAAA,gBAAAA,EAAA;AAAA,IAAI,CAACE,GAAM3C,MAClB,gBAAA0C,EAACP,MAAiB,WAAWb,EAAO,QAAQ,YAAU,IAAE,UAAAqB,MAAS,KAAK,MAAMA,KAAjE3C,CAAsE;AAAA,IAEnF,CAAA;AACD,CAAC;ACFe,SAAA4C,GAAU,EAAE,OAAAC,GAAO,QAAAC,GAAQ,UAAAC,GAAU,SAAAC,GAAS,WAAAC,GAAW,UAAAC,KAA4B;AACpG,QAAM,CAACC,GAAgBC,CAAiB,IAAIC,EAAS,CAAC,GAEhDC,IAAsB,MAAM;;AAC3B,UAAAC,KAAiBC,IAAAN,EAAS,YAAT,gBAAAM,EAAkB;AACrC,IAAAD,KAAkB,QAAMH,EAAkBG,CAAc;AAAA,EAAA;AAG7D,SACE,gBAAAE,EAAA,QAAA,EAAK,WAAWnC,EAAO,OACtB,UAAA;AAAA,IAAAwB,uBAAWX,IAAK,EAAA,WAAWb,EAAO,QAAQ,YAAU,IAAE,UAAOwB,EAAA,CAAA;AAAA,IAC9D,gBAAAW,EAAC,QAAK,EAAA,WAAWnC,EAAO,iBAAiB,GAAG,OAAO,EAAE,mBAAmB6B,EAAA,GACvE,UAAA;AAAA,MAAC,gBAAAT,EAAA,QAAA,EAAK,eAAY,QAAQ,UAAMG,GAAA;AAAA,MAChC,gBAAAH;AAAA,QAAC;AAAA,QAAA;AAAA,UACA,IAAG;AAAA,UACH,OAAAG;AAAA,UACA,cAAW;AAAA,UACX,UAAU,CAACa,MAAU;AACpB,YAAAX,EAASW,CAAK,GACMJ;UACrB;AAAA,UACA,KAAKJ;AAAA,UACL,SAAS,CAACQ,MAAU;AAAE,YAAAV,KAAA,QAAAA,EAAUU;AAAA,UAAQ;AAAA,UACxC,WAAW,CAACA,MAAU;AACrB,YAAAT,KAAA,QAAAA,EAAYS,IACQJ;UACrB;AAAA,UACA,SAASA;AAAA,UACT,YAAYA;AAAA,UACZ,UAAUA;AAAA,UACV,OAAOA;AAAA,UACP,QAAQA;AAAA,UACR,SAASA;AAAA,UACT,YAAY;AAAA,UACZ,cAAa;AAAA,UACb,WAAS;AAAA,QAAA;AAAA,MACV;AAAA,IAAA,GACD;AAAA,EACD,EAAA,CAAA;AAEF;ACpDO,MAAMK,IAAW,QACXC,IAAW,eACXC,KAAY,IAEZC,KAAkB,GAAGC,EAAK,GAAG,OAAOA,EAAK,WAAW,GAAG,+BAA+BA,EAAK,KAAK;AAAA,EACrGA,EAAK,WAAW,GAAG,sCAAsCA,EAAK,KAAK;AAAA,GAmB9DC,IAAkBD,EAAK,GAAG,MAC1BE,KAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAQpBF,EAAK,GAAG,KAAK,QAAQC,CAAe,KAAKD,EAAK,GAAG,KAAK,SAASC,CAAe;AAAA,UAC/ED,EAAK,GAAG,KAAK,MAAMC,CAAe,IAAID,EAAK,GAAG,KAAK,MAAMC,CAAe,IAAID,EAAK,GAAG,KAAK,QAAQC,CAAe;AAAA,UAChHD,EAAK,GAAG,KAAK,MAAMC,CAAe,IAAID,EAAK,GAAG,KAAK,MAAMC,CAAe,IAAID,EAAK,GAAG,KAAK,KAAKC,CAAe,IAAID,EAAK,GAAG,KAAK,MAAMC,CAAe;AAAA,WAClJD,EAAK,GAAG,KAAK,QAAQC,CAAe,KAAKD,EAAK,GAAG,KAAK,QAAQC,CAAe;AAAA;AAAA;AAAA;AAAA,8BCpClFE,KAAe;AAAA,EACpB,KAAK;AAAA,EACL,OAAO;AAAA,EACP,MAAM;AACP;AAEO,MAAMC,UAAeC,GAAkC;AAAA,EAAvD;AAAA;AAGN,IAAAC,EAAA,iBAAmB;AAAA;AAAA,EAEnB,MAAMC,GAA2C;AAChD,WAAI,KAAK,UACD,QAERA,KAAA,QAAAA,EAAW,OACX,KAAK,UAAU,IACf,KAAK,KAAK,OAAO,GACV;AAAA,EACR;AAAA,EAEA,OAAe;AACd,WAAK,KAAK,WAGV,KAAK,UAAU,IACf,KAAK,KAAK,MAAM,GACT,QAJC;AAAA,EAKT;AAAA,EAEA,KAAK9F,GAAsB;AAC1B,WAAI,KAAK,WACH,KAAA,KAAK,OAAOA,CAAI,GACf;AAAA,EACR;AACD;AA5BC6F,EADYF,GACL,eAAcD;ACPN,SAAAK,EAAYC,GAAqBC,GAAuB;AAChE,SAAA,GAAGV,EAAK,GAAG,GAAG,GAAGS,CAAW,KAAKC,CAAK,GAAGV,EAAK,KAAK;AAC3D;AAEO,SAASW,GAAWC,GAAwB;AAE3C,SAAAA,EAAO,QAAQ,uBAAuB,EAAE;AAChD;ACPA,IAAIC,IAAsB,CAAA;AAG1B,MAAMC,g2DAKAC,KAAe,MAAM;AAC1B,EAAAF,IAAW,CAAA;AAEX,aAAWG,KAAQF;AAClB,IAAKA,GAAQE,CAAI,EAAI,EAAA,KAAK,CAACC,MAAkB;AAC5C,YAAMR,IAAc,OAAO,KAAKQ,CAAwC,EAAE,CAAC,GAErEC,IAAWD,EAA0CR,CAAW;AAEtE,MAAIS,KAAW,SAGPA,EAAA,QAAQT,EAAY,YAAa,CAAA,GACzCI,EAAS,KAAKK,CAAO;AAAA,IAAA,CACrB;AAEH;AAEAH;AAEO,MAAMI,IAAN,MAAMA,EAAgB;AAAA,EAG5B,OAAO,KAAKC,GAA8B;AACzC,QAAIC,IAA+B;AAE9B,gBAAA,SAAS,QAAQ,CAACH,MAAY;AAC9B,UAAAA,EAAQ,SAASE,GAAM;AACX,QAAAC,IAAAH;AACf;AAAA,MACD;AAAA,IAAA,CACA,GAEMG;AAAA,EACR;AAAA,EAEA,OAAO,OAAOC,GAA4B;AAElC,WADS,KAAK,SAAS,OAAO,CAACJ,MAAY;;AAAA,cAAAzB,IAAAyB,EAAQ,SAAR,gBAAAzB,EAAc,MAAM6B;AAAA,KAAQ;AAAA,EAE/E;AAAA,EAEA,OAAO,SAAS;AACF,IAAAP,MACbI,EAAgB,WAAWN;AAAA,EAC5B;AACD;AAxBCP,EADYa,GACL,YAAWN;AADZ,IAAMU,KAANJ;ACNS,SAAAK,GAAS,EAAE,KAAAC,GAAK,MAAMC,GAAW,OAAAzE,GAAO,UAAA0E,GAAU,OAAOC,GAAM,QAAAC,GAAQ,OAAAC,EAAA,GAAwB;AAC9G,QAAMC,IAAgBC,MAChB,CAACC,GAAUC,CAAW,IAAI5C,EAAS,CAAC,GACpC,CAAC6C,GAAYC,CAAa,IAAI9C,EAASrC,KAAS,EAAE,GAClD,CAACoF,GAASC,CAAU,IAAIhD,EAAyB,CAAC;AAAA,IACvD,MAAMmC,IAAM1B,GAAgB,QAAQ,aAAa0B,EAAI,IAAI,IAAI1B;AAAA,IAC7D,SAAS;AAAA,EACT,CAAA,CAAC,GACIwC,IAAcC,MACd,CAACC,GAAkBC,CAAmB,IAAIpD,EAAwBiD,KAAA,gBAAAA,EAAa,SAASb,KAAa,IAAqB,GAC1HvC,IAAWwD,GAAO,IAAI,GACtB,CAACC,GAAcC,CAAe,IAAIvD,EAAS,CAAC,GAC5C,CAACwD,GAAQC,CAAS,IAAIzD,EAAwB,IAAI,GAClD,CAAC0D,GAAcC,EAAe,IAAI3D,EAAwB,IAAI,GAC9Db,IAAMkE,GAAO,IAAI,GACjB,CAACO,IAAeC,EAAgB,IAAI7D,EAAS,EAAK,GAClD8D,KAAkBC;AAExB,EAAAC,EAAU,MAAM;AACf,IAAIb,KAAoB,SACZd,KAAA,QAAAA,EAAA,GAAG/B,CAAQ,IAAIC,CAAQ,KAAK4C,EAAiB,OAAO,MAAMA,EAAiB,IAAI;AAAA,EAAE,GAC3F,CAACA,KAAA,gBAAAA,EAAkB,MAAMA,KAAA,gBAAAA,EAAkB,MAAMd,CAAQ,CAAC,GAE7D2B,EAAU,MAAM;AACX,IAAA,CAACnE,EAAS,WAAW,CAAC0C,KAGzB1C,EAAS,QAAwC;EAAM,GACtD,CAACA,GAAU0C,CAAM,CAAC;AAErB,QAAM0B,KAAa,MAAM;AACvB,IAAA9E,EAAI,QAAsC,YAAaA,EAAI,QAAsC;AAAA,EAAA;AAGnG,EAAA6E,EAAU,MAAM;AACf,IAAIJ,MAAiBzE,EAAI,WAAW,QAAQuE,KAAgB,SAGjDO,MACXJ,GAAiB,EAAI;AAAA,EACnB,GAAA,CAACD,IAAeF,GAAcvE,CAAG,CAAC,GAErC6E,EAAU,MAAM;AACX,IAAA7E,EAAI,WAAW,QAAQqE,KAAU,QAG1BS;EAAA,GACT,CAACpB,CAAU,CAAC;AAET,QAAApD,KAAS,GAAGiB,EAAK,GAAG,OAAOJ,CAAQ,IAAIC,IAAWG,EAAK,KAAK,IAC5DA,EAAK,GAAG,QAASyC,KAAA,QAAAA,EAAkB,QAAQA,KAAoB,OAAQ,MAAMA,KAAA,gBAAAA,EAAkB,QAAQzC,EAAK,KAAK,MAEjHwD,KAAiBnB,GACjBoB,IAAc,CAACC,MAAwB;AAC5C,IAAAF,GAAe,KAAKE,CAAK,GACzBpB,EAAWkB,EAAc;AAAA,EAAA,GAGpBG,IAAe,CAAClJ,MAAiB;AAC1B,IAAAgJ,EAAA;AAAA,MACX,MAAAhJ;AAAA,MACA,SAAS;AAAA,IAAA,CACT;AAAA,EAAA,GAGImJ,KAAgB,CAACd,GAAgBe,MAAoB;AAC1D,IAAAd,EAAUD,CAAM,GAChBK,GAAiB,EAAK;AAEhBjE,UAAAA,IAAY,CAACS,MAAyB;AAC3C,MAAIkC,MAAWlC,EAAM,WAAWA,EAAM,YAAYA,EAAM,QAAQ,OAC/DmD,EAAO,KAAK;AAAA,IACb;AAGD,QAAIgB,IAAqC;AAEzChB,IAAAA,EAAO,GAAG1C,EAAO,YAAY,KAAK,CAAC3F,MAAS;AAC3C,OAAM,YAAY;AACjB,YAAIsJ,IAA0BtJ;AAE9B,mBAAWuJ,KAAQH;AAClB,UAAIE,aAAkB3D,MAIb2D,IAAA,MAAME,GAAYF,IAAS,GAAGC,CAAI,IAAID,CAAgB,KAAKC,CAAI;AAGzE,YAAKD,aAA8B3D,GAAQ;AAC1C0C,UAAAA,EAAO,KAAK,GACCa,EAAA3D,EAAK,GAAG,MAAM,eAAe;AAC1C;AAAA,QACD;AAEa,QAAA8D,IAAAC,GACbd,GAAgBc,CAAgB;AAAA,MAAA;IAC9B,CACH,GAEDjB,EAAO,GAAG1C,EAAO,YAAY,MAAM,MAAM;AAC/B,eAAA,oBAAoB,WAAWlB,CAAS,GAEjDyE,EAAaG,CAAoB,GAEjCf,EAAU,IAAI,GACdE,GAAgB,IAAI;AAAA,IAAA,CACpB,GAEQ,SAAA,iBAAiB,WAAW/D,CAAS;AAAA,EAAA,GAGzC+E,KAAc,OAAOnF,MAA4C;;AACtE,UAAMoF,IAAqBpF,EAAM,QAAQ,GAAG,IAAI,GAC1CqF,IAAgBD,KAAsB,IAAI,KAAKpF,EAAM,OAAOoF,CAAkB,GAC9EE,IAAY,KAAK;AAGvB,QADAtF,IAAQA,EAAM,QACVA,MAAU,GAAI;AAGd,QAAAuF,IAAwBvF,EAAM,MAAM,uBAAuB;AAC/D,QAAIuF,KAAQ,KAAM;AACd,IAAAA,EAAK,CAAC,EAAE,kBAAkB,UAAUA,EAAK,UAAU,KAAGA,EAAK,MAAM;AAGrE,UAAM5D,KAAchB,KAAA4E,EAAK,MAAM,MAAX,gBAAA5E,GAAc;AAClC,QAAIgB,KAAe,KAAM;AACnB,UAAAS,IAAUK,GAAgB,KAAKd,CAAW;AAEhD,QAAI,CAACS,EAAgB,QAAAV,EAAYC,GAAa,mBAAmB;AAE1D,IAAA4D,IAAAA,EAAK,IAAI,CAACC,MACZA,EAAI,WAAW,GAAI,KAAKA,EAAI,SAAS,GAAI,IACrCA,EAAI,MAAM,GAAG,EAAE,IAEhBA,CACP;AAGD,UAAMnL,IAAoB,CAAA,GACpBoL,KAAiC,CAAA;AA8BnC,QA7BCF,EAAA,OAAO,CAACC,MAAgBA,EAAI,WAAW,GAAG,CAAC,EAAE,QAAQ,CAACE,MAAmB;AACvE,YAAAC,KAAY,CAAC9J,MAAgB;AAC9B,YAAAxB,EAAQ,SAASwB,CAAG;AACvB;AAED,QAAAxB,EAAQ,KAAKwB,CAAG;AAChB,cAAM+J,IAAgBxD,EAAQ,UAAU/H,EAAQA,EAAQ,SAAS,CAAC,CAAC;AAEnE,YAAIuL,KAAA,QAAAA,EAAe,SAAS;AAC3B,gBAAMC,KAAcN,EAAKA,EAAK,QAAQG,CAAM,IAAI,CAAC;AAC1C,UAAAD,GAAAG,EAAc,KAAK,IAAIC,IAC9BC,GAAgBD,IAAaN,CAAI;AAAA,QAClC;AAAA,MAAA;AAGG,UAAAG,EAAO,WAAW,IAAI,GAAG;AAC5B,cAAMK,IAAaL,EAAO,UAAU,CAAC,EAAE,YAAY;AACnD,QAAAC,GAAUI,CAAU;AAAA,MAAA;AAGP,QADQL,EAAO,UAAU,CAAC,EAAE,MAAM,EAAE,EACpC,QAAQ,CAACM,MAAwB;AAC7C,UAAAL,GAAUK,CAAW;AAAA,QAAA,CACrB;AAGF,MAAAF,GAAgBJ,GAAQH,CAAI;AAAA,IAAA,CAC5B,GAGGnD,EAAQ,eAAemD,EAAK,WAAW;AAC1C,aAAO7D,EAAYC,GAAa,oBAAoBA,CAAW,+BAA+B;AAE3F,QAAAS,EAAQ,kBAAkB/H,EAAQ,WAAW;AAChD,aAAOqH,EAAYC,GAAa,oBAAoBA,CAAW,6BAA6B;AAG7F,QAAIsE,IAAmC;AAEnC,QAAA;AAmBH,UAlBWA,IAAA,MAAM7D,EAAQ,QAAQmD,GAAM;AAAA,QACtC,cAAAV;AAAA,QACA,aAAAF;AAAA,QACA,aAAAlB;AAAA,QACA,kBAAAE;AAAA,QACA,qBAAAC;AAAA,QACA,UAAU9C;AAAA,QACV,UAAUC;AAAA,QACV,eAAAsE;AAAA,QACA,SAAAhL;AAAA,QACA,MAAAyI;AAAA,QACA,QAAA2C;AAAA,QACA,WAAAH;AAAA,QACA,iBAAAhB;AAAA,QACA,eAAArB;AAAA,QACA,KAAAN;AAAA,MAAA,CACA,GAEGsD,KAAY;AACR,eAAAvE,EAAYC,GAAa,gBAAgB;AAEjD,UAAI,CAAEsE,EAAgC;AAC9B,eAAAA;AAAA,aACArE,GAAO;AACf,qBAAQ,MAAMA,CAAK,GACZF,EAAYC,GAAa,gBAAgB;AAAA,IACjD;AAAA,EAAA,GAGKuE,KAAa,MAAM;AACxB,IAAA5C,EAAc,EAAE,GAChBS,EAAgB,CAAC;AAAA,EAAA,GAGZoC,KAAc,OAAOnG,MAAkB;AAChC,IAAA2E,EAAA;AAAA,MACX,MAAM1E,KAASD;AAAA,MACf,SAAS;AAAA,MACT,OAAAA;AAAA,IAAA,CACA;AAGG,QAAA+E,IAAQ/E,EAAM,MAAM,KAAK;AAC7B,UAAMoG,IAA2B,CAAA;AAEjC,QAAInB,IAAiC;AACrC,eAAWC,KAAQH;AAClB,MAAIE,aAAkB3D,MAIb2D,IAAA,MAAME,GAAYF,IAAS,GAAGC,CAAI,IAAID,CAAgB,KAAKC,CAAI,GACxEkB,EAAe,KAAKlB,CAAI;AAGd,IAAAgB,MAEHnB,IAAAA,EAAM,OAAO,CAACG,MAAS,CAACkB,EAAe,SAASlB,CAAI,CAAC,GAEzDD,MACCA,aAAkB3D,IACrBwD,GAAcG,GAAQF,CAAK,IAE3BF,EAAa,GAAGI,CAAgB;AAAA,CAAI;AAAA,EAEtC,GAGKoB,KAAqB,CAACC,MAAkB;AAC7C,UAAMC,IAAehD,EAAQ,OAAO,CAAC,EAAE,SAAAiD,EAAA,MAAcA,CAAO,GACtDrJ,IAAQsJ,GAAM3C,IAAewC,GAAO,GAAGC,EAAa,MAAM;AAEhE,QAAIpJ,MAAU2G,GAAc;AAC3B,MAAIwC,IAAQ,KACXhD,EAAc,EAAE;AAGjB;AAAA,IACD;AAEA,IACCA,EADGnG,MAAU,IACC,KAEAoJ,EAAaA,EAAa,SAASpJ,CAAK,EAAE,SAAS,EAFjD,GAKjB4G,EAAgB5G,CAAK;AAAA,EAAA,GAGhBiD,KAAY,CAACS,MAA+B;AAC3C,UAAAb,IAASa,EAAM,OAA4B,OAC3C,EAAE,KAAAhF,EAAQ,IAAAgF;AAEhB,IAAIhF,MAAQ,WACNsK,GAAYnG,CAAK,GACVoD,EAAA,CAACsD,MAAiBA,IAAc,CAAC,KACnC7K,MAAQ,aAClBgF,EAAM,eAAe,GACrBwF,GAAmB,CAAC,KACVxK,MAAQ,eAClBgF,EAAM,eAAe,GACrBwF,GAAmB,EAAE,KACX,CAACrC,MAAWnD,EAAM,WAAWA,EAAM,YAAYhF,MAAQ,OACnDyH,EAAA,CAACtD,MAAUA,IAAQ,IAAI;AAAA,EACtC,GAGKE,KAAW,CAACW,MAA6B;AACxC,UAAAb,IAASa,EAAM,OAA4B;AACjD,WAAOyC,EAActD,CAAK;AAAA,EAAA,GAGrB2G,KAAiB,MAAM;AACtB,UAAAC,IAAiBrD,EAAQ,MAAM,GAAG;AACxC,QAAInE,IAAa;AAEF,WAAAwH,EAAA,QAAQ,CAAChC,GAAOzH,MAAU;AACxC,MAAIyH,EAAM,UACTxF,IAAajC,IAAQ;AAAA,IAAA,CACtB,GAEMyJ,EAAe,MAAMxH,CAAU,EAAE,IAAI,CAAC,EAAE,MAAAzD,EAAK,GAAGwB,MAC/C,gBAAA0C,EAACJ,IAAW,EAAA,MAAA9D,EAAA,GAAiBwB,CAAM,CAC1C;AAAA,EAAA,GAGI0J,KAAc,CAAChG,MAAsB;;AAC1C,IAAAmC,KAAA,QAAAA,EAAQnC,IAEJA,EAAM,WAAW,MACpBA,EAAM,eAAe,IAErB/F,KAAA6F,IAAA,UAAU,WAAU,aAApB,QAAA7F,EAAA,KAAA6F,GAAiC,KAAK,CAAChF,MAAS;AAC/C,MAAA2H,EAAcD,IAAa1H,CAAI;AAAA,IAAA,GAC7B,MAAM,CAACiG,MAAU;AACnB,cAAQ,MAAMA,CAAK;AAAA,IAAA;AAAA,EAErB,GAGKkF,KAAgB,CAACjG,MAAiB;AACvC,IAAAA,EAAM,eAAe;AAAA,EAAA;AAIrB,SAAA,gBAAAD;AAAA,IAAC;AAAA,IAAA;AAAA,MACA,KAAAjB;AAAA,MACA,WAAWlB,EAAO;AAAA,MAClB,aAAAoI;AAAA,MACA,eAAAC;AAAA,MACA,SAAS,CAACjG,MAAU;;AACnB,UAAIF,IAAA,OAAO,aAAA,MAAP,gBAAAA,EAAuB,gBAAe,OACzCE,EAAM,eAAe,IACpB/F,IAAAuF,EAAS,YAAT,QAAAvF,EAA8C;AAAA,MAEjD;AAAA,MAEC,UAAA;AAAA,QAAe6L,GAAA;AAAA,QACd3C,IASC,gBAAAnE,EAACJ,IAAW,EAAA,MAAMyE,KAAgB,GAAG,CAAA,IARrC,gBAAArE;AAAA,UAACE;AAAA,UAAA;AAAA,YAEF,OAAOsD;AAAA,YACP,QAAApD;AAAA,YACA,WAAAG;AAAA,YACA,UAAAF;AAAA,YACA,UAAAG;AAAA,UAAA;AAAA,UALK8C;AAAA,QAAA;AAAA,MAOiC;AAAA,IAAA;AAAA,EAAA;AAI3C;ACrXA,MAAM4D,KAAW,IAAIC,GAAmB,YAAY,YAAYtE,EAAQ,EACtE,WAAW,wDAAwD,EACnE,QAAQuE,GAAW,UAAU,QAAQ,EACrC,YAAY,mBAAmB;AACjCF,GAAS,YAAY,EAAE,MAAM,yBAAyB,SAAS,UAAU,QAAQ,YAAY;","x_google_ignoreList":[0,1]}