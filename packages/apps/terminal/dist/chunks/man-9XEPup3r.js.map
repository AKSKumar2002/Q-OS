{"version":3,"file":"man-9XEPup3r.js","sources":["../../src/core/commands/man.ts"],"sourcesContent":["import { ANSI } from \"@prozilla-os/shared\";\nimport { formatError } from \"../_utils/terminal.utils\";\nimport { Command, ExecuteParams } from \"../command\";\nimport { CommandsManager } from \"../commands\";\n\nconst MARGIN = 5;\n\nexport const man = new Command()\n\t.setRequireArgs(true)\n\t.setManual({\n\t\tpurpose: \"Show system reference manuals\",\n\t\tusage: \"man [options] page\\n\"\n\t\t\t+ \"man -k [options] regexp\",\n\t\tdescription: \"Each page arguments given to man is normally the name of a command.\\n\"\n\t\t\t+ \"The manual page associated with this command is then found and displayed.\",\n\t\toptions: {\n\t\t\t\"-k\": \"Search for manual page using regexp\",\n\t\t},\n\t})\n\t.setExecute(function(this: Command, args, params) {\n\t\tconst { options } = params as ExecuteParams;\n\n\t\t// Search function\n\t\tif (options?.includes(\"k\")) {\n\t\t\tconst commands = CommandsManager.search((args as string[])[0].toLowerCase());\n\t\t\treturn commands.map((command) => {\n\t\t\t\tif (command.manual?.purpose) {\n\t\t\t\t\treturn  `${command.name} - ${command.manual.purpose}`;\n\t\t\t\t} else {\n\t\t\t\t\treturn command.name;\n\t\t\t\t}\n\t\t\t}).sort().join(\"\\n\");\n\t\t}\n\n\t\tconst commandName = (args as string[])[0].toLowerCase();\n\t\tconst command = CommandsManager.find(commandName);\n\n\t\tif (!command)\n\t\t\treturn formatError(this.name, `${commandName}: Command not found`);\n\n\t\tconst manual = command.manual;\n\n\t\tif (!manual)\n\t\t\treturn formatError(this.name, `${commandName}: No manual found`);\n\n\t\tconst formatText = (text: string) => {\n\t\t\tconst lines = text.split(\"\\n\").map((line) => \" \".repeat(MARGIN) + line);\n\t\t\treturn lines.join(\"\\n\");\n\t\t};\n\n\t\tconst sections = [[\"NAME\"]];\n\n\t\tif (manual.purpose) {\n\t\t\tsections[0].push(formatText(`${commandName} - ${ANSI.decoration.dim}${ANSI.fg.yellow}${manual.purpose}${ANSI.reset}`));\n\t\t} else {\n\t\t\tsections[0].push(formatText(commandName));\n\t\t}\n\n\t\tif (manual.usage) {\n\t\t\tsections.push([\n\t\t\t\t\"SYNOPSIS\",\n\t\t\t\tformatText(manual.usage),\n\t\t\t]);\n\t\t}\n\t\t\n\t\tif (manual.description) {\n\t\t\tsections.push([\n\t\t\t\t\"DESCRIPTION\",\n\t\t\t\tformatText(manual.description),\n\t\t\t]);\n\t\t}\n\n\t\tif (manual.options) {\n\t\t\tsections.push([\n\t\t\t\t\"OPTIONS\",\n\t\t\t\tformatText(Object.entries(manual.options).map(([key, value]) => {\n\t\t\t\t\treturn `${key} ${ANSI.decoration.dim}${ANSI.fg.yellow}${value}${ANSI.reset}`;\n\t\t\t\t}).join(\"\\n\")),\n\t\t\t]);\n\t\t}\n\n\t\treturn sections.map((section) => {\n\t\t\tsection[0] = ANSI.fg.yellow + section[0] + ANSI.reset;\n\t\t\treturn section.join(\"\\n\");\n\t\t}).join(\"\\n\\n\");\n\t});"],"names":["MARGIN","man","Command","args","params","options","CommandsManager","command","commandName","formatError","manual","formatText","text","line","sections","ANSI","key","value","section"],"mappings":";;;AAKA,MAAMA,IAAS,GAEFC,IAAM,IAAIC,IACrB,eAAe,EAAI,EACnB,UAAU;AAAA,EACV,SAAS;AAAA,EACT,OAAO;AAAA;AAAA,EAEP,aAAa;AAAA;AAAA,EAEb,SAAS;AAAA,IACR,MAAM;AAAA,EACP;AACD,CAAC,EACA,WAAW,SAAwBC,GAAMC,GAAQ;AAC3C,QAAA,EAAE,SAAAC,EAAY,IAAAD;AAGhB,MAAAC,KAAA,QAAAA,EAAS,SAAS;AAEd,WADUC,EAAgB,OAAQH,EAAkB,CAAC,EAAE,aAAa,EAC3D,IAAI,CAACI,MAAY;;AAC5BA,cAAAA,IAAAA,EAAQ,WAARA,QAAAA,EAAgB,UACX,GAAGA,EAAQ,IAAI,MAAMA,EAAQ,OAAO,OAAO,KAE5CA,EAAQ;AAAA,IAEhB,CAAA,EAAE,KAAK,EAAE,KAAK;AAAA,CAAI;AAGpB,QAAMC,IAAeL,EAAkB,CAAC,EAAE,YAAY,GAChDI,IAAUD,EAAgB,KAAKE,CAAW;AAEhD,MAAI,CAACD;AACJ,WAAOE,EAAY,KAAK,MAAM,GAAGD,CAAW,qBAAqB;AAElE,QAAME,IAASH,EAAQ;AAEvB,MAAI,CAACG;AACJ,WAAOD,EAAY,KAAK,MAAM,GAAGD,CAAW,mBAAmB;AAE1D,QAAAG,IAAa,CAACC,MACLA,EAAK,MAAM;AAAA,CAAI,EAAE,IAAI,CAACC,MAAS,IAAI,OAAOb,CAAM,IAAIa,CAAI,EACzD,KAAK;AAAA,CAAI,GAGjBC,IAAW,CAAC,CAAC,MAAM,CAAC;AAE1B,SAAIJ,EAAO,UACDI,EAAA,CAAC,EAAE,KAAKH,EAAW,GAAGH,CAAW,MAAMO,EAAK,WAAW,GAAG,GAAGA,EAAK,GAAG,MAAM,GAAGL,EAAO,OAAO,GAAGK,EAAK,KAAK,EAAE,CAAC,IAErHD,EAAS,CAAC,EAAE,KAAKH,EAAWH,CAAW,CAAC,GAGrCE,EAAO,SACVI,EAAS,KAAK;AAAA,IACb;AAAA,IACAH,EAAWD,EAAO,KAAK;AAAA,EAAA,CACvB,GAGEA,EAAO,eACVI,EAAS,KAAK;AAAA,IACb;AAAA,IACAH,EAAWD,EAAO,WAAW;AAAA,EAAA,CAC7B,GAGEA,EAAO,WACVI,EAAS,KAAK;AAAA,IACb;AAAA,IACAH,EAAW,OAAO,QAAQD,EAAO,OAAO,EAAE,IAAI,CAAC,CAACM,GAAKC,CAAK,MAClD,GAAGD,CAAG,IAAID,EAAK,WAAW,GAAG,GAAGA,EAAK,GAAG,MAAM,GAAGE,CAAK,GAAGF,EAAK,KAAK,EAC1E,EAAE,KAAK;AAAA,CAAI,CAAC;AAAA,EAAA,CACb,GAGKD,EAAS,IAAI,CAACI,OACZA,EAAA,CAAC,IAAIH,EAAK,GAAG,SAASG,EAAQ,CAAC,IAAIH,EAAK,OACzCG,EAAQ,KAAK;AAAA,CAAI,EACxB,EAAE,KAAK;AAAA;AAAA,CAAM;AACf,CAAC;"}