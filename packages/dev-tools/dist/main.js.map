{"version":3,"file":"main.js","sources":["../src/features/console.ts","../src/plugins/stageSite.ts","../src/plugins/appMetadata.ts","../src/configs/app.vite.config.ts"],"sourcesContent":["import { ANSI } from \"@prozilla-os/shared\";\n\nexport type Status = \"error\" | \"info\" | \"file\" | \"success\" | \"start\";\n\nexport function print(message: string, status?: Status, newLine?: boolean) {\n\tif (newLine)\n\t\tconsole.log(\"\");\n\n\tif (status == null)\n\t\treturn console.log(message);\n\n\tswitch (status) {\n\t\tcase \"start\":\n\t\t\tconsole.log(`${ANSI.fg.yellow}${message}...${ANSI.reset}`);\n\t\t\tbreak;\n\t\tcase \"file\":\n\t\t\tconsole.log(`- ${ANSI.fg.cyan}${message}${ANSI.reset}`);\n\t\t\tbreak;\n\t\tcase \"success\":\n\t\t\tconsole.log(`${ANSI.fg.green}✓ ${message}${ANSI.reset}`);\n\t\t\tbreak;\n\t\tcase \"error\":\n\t\t\tconsole.error(`${ANSI.fg.red}⚠ ${message}${ANSI.reset}`);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tconsole.log(message);\n\t\t\tbreak;\n\t}\n}","import type { AppsConfig } from \"@prozilla-os/core\";\nimport type { OutputBundle, PluginContext, Plugin } from \"rollup\";\nimport { print } from \"../features\";\n\nexport interface StageOptions {\n\tappsConfig: AppsConfig;\n\n\t/**\n\t * Favicon of the website\n\t */\n\tfavicon: string;\n\n\t/**\n\t * Name of the website \n\t * @example \"ProzillaOS\"\n\t */\n\tsiteName: string;\n\n\t/**\n\t * Tag line of the website\n\t * @example \"Web-based Operating System\"\n\t*/\n\tsiteTagLine: string;\n\n\t/**\n\t * Domain of the live website\n\t * \n\t * A CNAME file will be generated with this value\n\t * @example \"os.prozilla.dev\"\n\t */\n\tdomain: string;\n\n\t/**\n\t * Array of image URLs that will be added to the sitemap\n\t */\n\timageUrls?: string[];\n}\n\ninterface StageOptionsExtended extends StageOptions {\n\timageUrls: string[];\n\tbaseUrl: string;\n\tpaths: FilePaths;\n}\n\ninterface FilePaths {\n\tsitemapXml: string;\n\trobotsTxt: string;\n\tindexHtml: string;\n\tcname: string;\n}\n\nfunction normalizeLineEndings(text: string) {\n\treturn text.replace(/\\r\\n/g, \"\\n\");\n}\n\nfunction generateSitemapXml(options: StageOptionsExtended) {\n\tconst { imageUrls, appsConfig, baseUrl } = options;\n\n\tconst date = new Date();\n\n\tconst year = date.getFullYear();\n\tconst month = date.getMonth() + 1;\n\tconst day = date.getDate();\n\n\tconst monthString = month >= 10 ? month.toString() : \"0\" + month;\n\tconst dayString = day >= 10 ? day.toString() : \"0\" + day;\n\n\tconst lastModified = `${year}-${monthString}-${dayString}`;\n\n\tconst images = imageUrls.map((path) => `\n\t\t<image:image>\n\t\t\t<image:loc>${baseUrl.slice(0, -1) + path}</image:loc>\n\t\t</image:image>`\n\t);\n\n\tconst pages = appsConfig.apps.map(({ id }) => `\n\t<url>\n\t\t<loc>${baseUrl + id}</loc>\n\t\t<lastmod>${lastModified}</lastmod>\n\t</url>`\n\t);\n\n\tconst sitemap = `\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE xml>\n<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\"\n\txmlns:image=\"http://www.google.com/schemas/sitemap-image/1.1\">\n\t<url>\n\t\t<loc>${baseUrl}</loc>\n\t\t<lastmod>${lastModified}</lastmod>\n\t\t${images.join(\"\")}\n\t</url>\n\t${pages.join(\"\")}\n</urlset>`;\n\n\treturn normalizeLineEndings(sitemap.trim());\n}\n\nfunction generateRobotsTxt(options: StageOptionsExtended) {\n\tconst { baseUrl } = options;\n\n\treturn normalizeLineEndings(`# https://www.robotstxt.org/robotstxt.html\nUser-agent: *\nDisallow:\nSitemap: ${baseUrl}sitemap.xml`);\n}\n\nfunction generateCname(options: StageOptionsExtended) {\n\treturn options.domain;\n}\n\nfunction generateTemplate(html: string, options: StageOptionsExtended) {\n\tconst { baseUrl } = options;\n\n\tconst baseUrlRegex = /(?<=\")https?:\\/\\/[a-z0-9-]+(\\.)([a-zA-Z0-9-]+(\\.))*[a-z]{2,3}\\/(?=.*\")/gi;\n\thtml = html.replaceAll(baseUrlRegex, baseUrl);\n\n\tconst commentsRegex = /<!--.*?-->/g;\n\thtml = html.replaceAll(commentsRegex, \"\");\n\n\tconst emptyLinesRegex = /^\\s*$\\n/gm;\n\thtml = html.replaceAll(emptyLinesRegex, \"\");\n\n\treturn normalizeLineEndings(html);\n}\n\n/**\n * To avoid GitHub pages rendering certain pages that are only defined by React router as a 404 page,\n * we copy the content of our index file to the 404 page, letting React router properly handle routing on every page \n */\nfunction generate404Page(context: PluginContext, template: string) {\n\tcontext.emitFile({\n\t\ttype: \"asset\",\n\t\tfileName: \"404.html\",\n\t\tsource: template,\n\t});\n}\n\n/**\n * Add an HTML file for every app page so they can be properly crawled and indexed\n */\nfunction generateAppPages(context: PluginContext, template: string, options: StageOptionsExtended) {\n\tconst { appsConfig, favicon, siteName, siteTagLine, baseUrl } = options;\n\n\tfor (const app of appsConfig.apps) {\n\t\tconst appId = app.id;\n\t\tconst appName = app.name;\n\t\tconst appDescription = app.description ?? siteTagLine;\n\t\tconst appIcon = app.iconUrl ?? favicon;\n\n\t\tif (appId === \"index\") {\n\t\t\tprint(\"Invalid app ID found: \" + appId, \"error\");\n\t\t\treturn;\n\t\t}\n\n\t\tlet html = template;\n\t\t\n\t\tconst titleRegex = /(?<=(<title>|<meta property=\"og:title\" content=\"|<meta name=\"twitter:title\" content=\"))(([a-zA-Z|-]|\\s)+)(?=(<\\/title>|\"\\/?>))/g;\n\t\thtml = html.replaceAll(titleRegex, `${appName} | ${siteName}`);\n\n\t\tconst descriptionRegex = /(?<=(<meta name=\"description\" content=\"|<meta property=\"og:description\" content=\"|<meta name=\"twitter:description\" content=\"))(([a-zA-Z-.]|\\s)+)(?=(\"\\/?>))/g;\n\t\thtml = html.replaceAll(descriptionRegex, appDescription);\n\n\t\tconst canonicalRegex = /(?<=(<link rel=\"canonical\" href=\"|<meta name=\"twitter:url\" content=\"|<meta property=\"og:url\" content=\"))(http(s)?:\\/\\/[a-zA-Z-.]+\\/)(?=(\"\\/?>))/g;\n\t\thtml = html.replaceAll(canonicalRegex, baseUrl + appId);\n\n\t\tconst iconRegex = /(?<=<link [^>]*rel=\"(apple-touch-)?icon\" [^>]*href=\")[^\"]+(?=\"[^>]*>)/g;\n\t\thtml = html.replaceAll(iconRegex, `${appIcon}?x=${Math.round(Date.now() / 3_600_000)}`);\n\n\t\tconst faqRegex = /(<!-- FAQ -->.*?)?<script type=\"application\\/ld\\+json\">.*?<\\/script>/gs;\n\t\thtml = html.replaceAll(faqRegex, \"\");\n\n\t\tcontext.emitFile({\n\t\t\ttype: \"asset\",\n\t\t\tfileName: `${appId}.html`,\n\t\t\tsource: html,\n\t\t});\n\t}\n}\n\nfunction stageSite(context: PluginContext, bundle: OutputBundle, { appsConfig, favicon, siteName, siteTagLine, domain, imageUrls = [] }: StageOptions) {\n\ttry {\n\t\tprint(\"Staging build...\", \"start\", true);\n\n\t\tconst baseUrl = `https://${domain}/`;\n\n\t\tconst paths: FilePaths = {\n\t\t\tsitemapXml: \"sitemap.xml\",\n\t\t\trobotsTxt: \"robots.txt\",\n\t\t\tindexHtml: \"index.html\",\n\t\t\tcname: \"CNAME\",\n\t\t};\n\t\n\t\tconst files: [string, (options: StageOptionsExtended) => string][] = [\n\t\t\t[paths.sitemapXml, generateSitemapXml],\n\t\t\t[paths.robotsTxt, generateRobotsTxt],\n\t\t\t[paths.cname, generateCname],\n\t\t];\n\n\t\tconst extendedOptions = {\n\t\t\tappsConfig,\n\t\t\tfavicon,\n\t\t\tsiteName,\n\t\t\tsiteTagLine,\n\t\t\tdomain,\n\t\t\tbaseUrl,\n\t\t\timageUrls,\n\t\t\tpaths,\n\t\t};\n\t\n\t\tfiles.forEach(([path, generateContent]) => {\n\t\t\tcontext.emitFile({\n\t\t\t\ttype: \"asset\",\n\t\t\t\tfileName: path,\n\t\t\t\tsource: generateContent(extendedOptions),\n\t\t\t});\n\t\t});\n\n\t\tconst html = bundle[\"index.html\"];\n\t\tif (html && html.type == \"asset\") {\n\t\t\tconst template = generateTemplate(html.source as string, extendedOptions);\n\n\t\t\tcontext.emitFile({\n\t\t\t\ttype: \"asset\",\n\t\t\t\tfileName: \"index.html\",\n\t\t\t\tsource: template, \n\t\t\t});\n\t\n\t\t\tgenerate404Page(context, template);\n\t\t\tgenerateAppPages(context, template, extendedOptions);\n\t\t}\n\t\n\t\tprint(\"Staging complete\", \"success\", true);\n\t} catch (error) {\n\t\tconsole.error(error);\n\t\tprint(\"Staging failed\", \"error\");\n\t\tprocess.exit(1);\n\t}\n}\n\nexport function stageSitePlugin(options: StageOptions): Plugin {\n\treturn {\n\t\tname: \"vite-plugin-stage-site\",\n\t\tgenerateBundle(_outputOptions, bundle) {\n\t\t\tstageSite(this, bundle, options);\n\t\t},\n\t};\n}","import { readFileSync } from \"fs\";\nimport { resolve } from \"path\";\nimport { RollupError } from \"rollup\";\nimport { Plugin } from \"vite\";\n\ninterface PackageJson {\n\tname: string;\n\tversion: string;\n\tauthor?: string | { name: string };\n}\n\ninterface AppMetadataPluginOptions {\n\tentryPath: string;\n}\n\nexport function appMetadataPlugin({ entryPath }: AppMetadataPluginOptions): Plugin {\n\treturn {\n\t\tname: \"vite-plugin-app-metadata\",\n\t\tapply: \"build\",\n\t\tload(id) {\n\t\t\tif (!id.includes(entryPath)) return null;\n\t\t\n\t\t\tconst rootDir = process.cwd();\n\t\t\tconst packageJsonPath = resolve(rootDir, \"package.json\");\n\t\t\n\t\t\t// Read and parse the package.json file\n\t\t\tlet packageJson: PackageJson | null = null;\n\t\t\ttry {\n\t\t\t\tconst packageJsonContent = readFileSync(packageJsonPath, \"utf-8\");\n\t\t\t\tpackageJson = JSON.parse(packageJsonContent) as PackageJson;\n\t\t\t} catch (error) {\n\t\t\t\tthis.error(error as RollupError);\n\t\t\t}\n\n\t\t\tif (!packageJson)\n\t\t\t\treturn null;\n\t\t\n\t\t\tconst { name, version } = packageJson;\n\t\t\tlet { author = \"Unknown\" } = packageJson;\n\n\t\t\tif (typeof author == \"string\") {\n\t\t\t\tauthor = author.replace(/<[^>]*>|\\([^)]*\\)/g, \"\").trim();\n\t\t\t} else {\n\t\t\t\tauthor = author.name;\n\t\t\t}\n\t\t\n\t\t\t// Read the source file content\n\t\t\tlet code: string | null = null;\n\t\t\ttry {\n\t\t\t\tcode = readFileSync(id, \"utf-8\");\n\t\t\t} catch (error) {\n\t\t\t\tthis.error(error as RollupError);\n\t\t\t}\n\n\t\t\tif (code == null)\n\t\t\t\treturn null;\n\n\t\t\t// Find instance of app class\n\t\t\tconst appInstanceRegex = /const\\s+(\\w+)\\s*=\\s*new\\s+App(?:<[\\w\\s,]+>)?\\s*\\(([^;]*)\\)\\s*(\\.[\\w]+\\([^)]*\\)\\s*)*;/;\n\t\t\tconst match = code.match(appInstanceRegex);\n\t\t\n\t\t\tif (match) {\n\t\t\t\tconst appInstanceName = match[1];\n\t\t\n\t\t\t\t// Inject code to set metadata of app\n\t\t\t\tconst injectCode = `\\n${appInstanceName}.setMetadata({ name: \"${name}\", version: \"${version}\", author: \"${author}\" });\\n`;\n\t\t\t\tconst modifiedCode = code.replace(appInstanceRegex, match[0] + injectCode);\n\t\t\n\t\t\t\treturn modifiedCode; \n\t\t\t} else {\n\t\t\t\tthis.warn(\"No App instance found in the entry file.\");\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t};\n}","import { UserConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react-swc\";\nimport dts from \"vite-plugin-dts\";\nimport cssInjectedByJs from \"vite-plugin-css-injected-by-js\";\nimport { posix, resolve, sep } from \"path\";\nimport { appMetadataPlugin } from \"../plugins\";\n\n/**\n * Helper function for creating Vite configurations for ProzillaOS apps\n * @param basePath - Path of base directory\n * @param entryPath - Path of library entry\n * @returns Vite configuration\n * @see https://vitejs.dev/config/\n */\nexport const appViteConfig = (basePath: string, entryPath: string): UserConfig => {\n\tlet entryFile = resolve(basePath, entryPath);\n\n\t// Normalize paths for Windows compatibility\n\tif (sep === \"\\\\\")\n\t\tentryFile = entryFile.split(sep).join(posix.sep);\n\n\tconsole.log(\"Using Vite config for app\");\n\tconsole.log(\"Entry: \" + entryFile);\n\n\treturn {\n\t\tplugins: [\n\t\t\tappMetadataPlugin({\n\t\t\t\tentryPath,\n\t\t\t}),\n\t\t\treact(),\n\t\t\tcssInjectedByJs(),\n\t\t\tdts({\n\t\t\t\toutDir: \"dist\",\n\t\t\t\trollupTypes: true,\n\t\t\t\tstrictOutput: true,\n\t\t\t\tpathsToAliases: false,\n\t\t\t\ttsconfigPath: \"tsconfig.build.json\",\n\t\t\t}),\n\t\t],\n\t\tbuild: {\n\t\t\tlib: {\n\t\t\t\tentry: entryFile,\n\t\t\t\tformats: [\"es\"],\n\t\t\t},\n\t\t\trollupOptions: {\n\t\t\t\texternal: [\"react\", \"react/jsx-runtime\", \"@prozilla-os/core\", \"@prozilla-os/shared\", \"@prozilla-os/skins\", /@fortawesome\\/*/g],\n\t\t\t\toutput: {\n\t\t\t\t\tassetFileNames: \"assets/[name][extname]\",\n\t\t\t\t\tchunkFileNames: \"chunks/[name]-[hash].js\",\n\t\t\t\t\tentryFileNames: \"[name].js\",\n\t\t\t\t},\n\t\t\t},\n\t\t\tsourcemap: true,\n\t\t},\n\t};\n};"],"names":["print","message","status","newLine","ANSI","normalizeLineEndings","text","generateSitemapXml","options","imageUrls","appsConfig","baseUrl","date","year","month","day","monthString","dayString","lastModified","images","path","pages","id","sitemap","generateRobotsTxt","generateCname","generateTemplate","html","baseUrlRegex","commentsRegex","emptyLinesRegex","generate404Page","context","template","generateAppPages","favicon","siteName","siteTagLine","app","appId","appName","appDescription","appIcon","titleRegex","descriptionRegex","canonicalRegex","iconRegex","faqRegex","stageSite","bundle","domain","paths","files","extendedOptions","generateContent","error","stageSitePlugin","_outputOptions","appMetadataPlugin","entryPath","rootDir","packageJsonPath","resolve","packageJson","packageJsonContent","readFileSync","name","version","author","code","appInstanceRegex","match","injectCode","appViteConfig","basePath","entryFile","sep","posix","react","cssInjectedByJs","dts"],"mappings":"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"}